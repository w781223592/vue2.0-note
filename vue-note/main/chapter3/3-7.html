<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.7 异步组件 | 卷心菜笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./logo.jpg">
    <meta name="description" content="基于vue@2.6.14的学习笔记">
    
    <link rel="preload" href="./assets/css/0.styles.74c59701.css" as="style"><link rel="preload" href="./assets/js/app.20317d9d.js" as="script"><link rel="preload" href="./assets/js/2.8a65079d.js" as="script"><link rel="preload" href="./assets/js/3.5a34bef2.js" as="script"><link rel="prefetch" href="./assets/js/10.3d2f32ec.js"><link rel="prefetch" href="./assets/js/11.132a26b4.js"><link rel="prefetch" href="./assets/js/12.d0193009.js"><link rel="prefetch" href="./assets/js/13.07872830.js"><link rel="prefetch" href="./assets/js/14.96a92186.js"><link rel="prefetch" href="./assets/js/15.89c1bf18.js"><link rel="prefetch" href="./assets/js/16.78f7cadf.js"><link rel="prefetch" href="./assets/js/17.eee5b860.js"><link rel="prefetch" href="./assets/js/18.e94d03e8.js"><link rel="prefetch" href="./assets/js/19.9e73c1ac.js"><link rel="prefetch" href="./assets/js/20.ae18bc8e.js"><link rel="prefetch" href="./assets/js/21.d4a5ba0b.js"><link rel="prefetch" href="./assets/js/22.e7794d4a.js"><link rel="prefetch" href="./assets/js/23.adaee962.js"><link rel="prefetch" href="./assets/js/24.e1df98bf.js"><link rel="prefetch" href="./assets/js/25.c325e810.js"><link rel="prefetch" href="./assets/js/26.c24daaf7.js"><link rel="prefetch" href="./assets/js/27.a3f09949.js"><link rel="prefetch" href="./assets/js/28.123d6383.js"><link rel="prefetch" href="./assets/js/29.04a6e255.js"><link rel="prefetch" href="./assets/js/30.f976c0a7.js"><link rel="prefetch" href="./assets/js/31.60d2f4c4.js"><link rel="prefetch" href="./assets/js/32.6b2a5515.js"><link rel="prefetch" href="./assets/js/33.6b80e89d.js"><link rel="prefetch" href="./assets/js/34.ea39628f.js"><link rel="prefetch" href="./assets/js/35.4c14bc3d.js"><link rel="prefetch" href="./assets/js/36.5f2b7559.js"><link rel="prefetch" href="./assets/js/37.57e976da.js"><link rel="prefetch" href="./assets/js/38.191568b8.js"><link rel="prefetch" href="./assets/js/39.f89500e6.js"><link rel="prefetch" href="./assets/js/4.9fb18247.js"><link rel="prefetch" href="./assets/js/40.a45a4a21.js"><link rel="prefetch" href="./assets/js/41.94ece143.js"><link rel="prefetch" href="./assets/js/42.224304d2.js"><link rel="prefetch" href="./assets/js/43.544241cd.js"><link rel="prefetch" href="./assets/js/44.6014c885.js"><link rel="prefetch" href="./assets/js/45.711ad2c3.js"><link rel="prefetch" href="./assets/js/46.19b76064.js"><link rel="prefetch" href="./assets/js/47.0a8f7a4f.js"><link rel="prefetch" href="./assets/js/48.da28ae74.js"><link rel="prefetch" href="./assets/js/49.97615384.js"><link rel="prefetch" href="./assets/js/5.0c239c66.js"><link rel="prefetch" href="./assets/js/50.06bd69e2.js"><link rel="prefetch" href="./assets/js/51.ea943f69.js"><link rel="prefetch" href="./assets/js/52.b4813218.js"><link rel="prefetch" href="./assets/js/53.c1ba1696.js"><link rel="prefetch" href="./assets/js/54.e1d1801c.js"><link rel="prefetch" href="./assets/js/55.ac7cd0ab.js"><link rel="prefetch" href="./assets/js/56.d55c7dcb.js"><link rel="prefetch" href="./assets/js/57.83bbfc8e.js"><link rel="prefetch" href="./assets/js/58.6996ec46.js"><link rel="prefetch" href="./assets/js/59.42c770e8.js"><link rel="prefetch" href="./assets/js/6.0600552c.js"><link rel="prefetch" href="./assets/js/60.919088d2.js"><link rel="prefetch" href="./assets/js/61.455d2404.js"><link rel="prefetch" href="./assets/js/62.40ba97a6.js"><link rel="prefetch" href="./assets/js/63.5b069dba.js"><link rel="prefetch" href="./assets/js/64.512e158a.js"><link rel="prefetch" href="./assets/js/65.6ca1c75b.js"><link rel="prefetch" href="./assets/js/66.0356130d.js"><link rel="prefetch" href="./assets/js/67.93a0d7df.js"><link rel="prefetch" href="./assets/js/68.7e44cc19.js"><link rel="prefetch" href="./assets/js/69.788a4d27.js"><link rel="prefetch" href="./assets/js/7.6346a45d.js"><link rel="prefetch" href="./assets/js/70.571f8a79.js"><link rel="prefetch" href="./assets/js/71.f54eb805.js"><link rel="prefetch" href="./assets/js/72.02cd77d0.js"><link rel="prefetch" href="./assets/js/73.66b6b1d0.js"><link rel="prefetch" href="./assets/js/74.96bf5acc.js"><link rel="prefetch" href="./assets/js/75.1b135bdd.js"><link rel="prefetch" href="./assets/js/76.6ed173f1.js"><link rel="prefetch" href="./assets/js/77.ee856c8d.js"><link rel="prefetch" href="./assets/js/78.b8fc2c30.js"><link rel="prefetch" href="./assets/js/79.7665732d.js"><link rel="prefetch" href="./assets/js/8.6ff51652.js"><link rel="prefetch" href="./assets/js/80.03e59e67.js"><link rel="prefetch" href="./assets/js/81.a6236c2f.js"><link rel="prefetch" href="./assets/js/82.88a5092b.js"><link rel="prefetch" href="./assets/js/83.e93ce178.js"><link rel="prefetch" href="./assets/js/84.8eb37a19.js"><link rel="prefetch" href="./assets/js/85.9d8d91db.js"><link rel="prefetch" href="./assets/js/86.14696351.js"><link rel="prefetch" href="./assets/js/87.51a4cddc.js"><link rel="prefetch" href="./assets/js/88.5cb86311.js"><link rel="prefetch" href="./assets/js/89.11fe5589.js"><link rel="prefetch" href="./assets/js/9.aaa202b7.js"><link rel="prefetch" href="./assets/js/90.b3555572.js">
    <link rel="stylesheet" href="./assets/css/0.styles.74c59701.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">卷心菜笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./main/" class="nav-link router-link-active">
  正文
</a></div><div class="nav-item"><a href="/./appendix/mergeOptions.html" class="nav-link">
  附录
</a></div><div class="nav-item"><a href="/./util/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/w781223592/vue2.0-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./main/" class="nav-link router-link-active">
  正文
</a></div><div class="nav-item"><a href="/./appendix/mergeOptions.html" class="nav-link">
  附录
</a></div><div class="nav-item"><a href="/./util/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/w781223592/vue2.0-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/./main/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第一章 初识Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter1/1-1.html" class="sidebar-link">1.1 Vue目录设计</a></li><li><a href="/./main/chapter1/1-2.html" class="sidebar-link">1.2 Vue入口文件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第二章 Vue初始化和挂载</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter2/2-1.html" class="sidebar-link">2.1 new Vue()时做了什么</a></li><li><a href="/./main/chapter2/2-2.html" class="sidebar-link">2.2 Vue实例挂载的实现</a></li><li><a href="/./main/chapter2/2-3.html" class="sidebar-link">2.3 Vue挂载时的mountComponent</a></li><li><a href="/./main/chapter2/2-4.html" class="sidebar-link">2.4 Virtual DOM</a></li><li><a href="/./main/chapter2/2-5.html" class="sidebar-link">2.5 最终的挂载方法_update</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>第三章 组件化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter3/3-1.html" class="sidebar-link">3.1 创建组件vnode</a></li><li><a href="/./main/chapter3/3-2.html" class="sidebar-link">3.2 组件的patch过程</a></li><li><a href="/./main/chapter3/3-3.html" class="sidebar-link">3.3 合并配置</a></li><li><a href="/./main/chapter3/3-4.html" class="sidebar-link">3.4 生命周期（上）</a></li><li><a href="/./main/chapter3/3-5.html" class="sidebar-link">3.5 生命周期（下）</a></li><li><a href="/./main/chapter3/3-6.html" class="sidebar-link">3.6 组件的注册</a></li><li><a href="/./main/chapter3/3-7.html" aria-current="page" class="active sidebar-link">3.7 异步组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第四章 响应式原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter4/4-1.html" class="sidebar-link">4.1 响应式对象</a></li><li><a href="/./main/chapter4/4-2.html" class="sidebar-link">4.2 依赖收集（上）</a></li><li><a href="/./main/chapter4/4-3.html" class="sidebar-link">4.3 依赖收集（下）</a></li><li><a href="/./main/chapter4/4-4.html" class="sidebar-link">4.4 派发更新</a></li><li><a href="/./main/chapter4/4-5.html" class="sidebar-link">4.5 nextTick</a></li><li><a href="/./main/chapter4/4-6.html" class="sidebar-link">4.6 检测变化的坑</a></li><li><a href="/./main/chapter4/4-7.html" class="sidebar-link">4.7 计算属性</a></li><li><a href="/./main/chapter4/4-8.html" class="sidebar-link">4.8 侦听器</a></li><li><a href="/./main/chapter4/4-9.html" class="sidebar-link">4.9 组件更新</a></li><li><a href="/./main/chapter4/4-10.html" class="sidebar-link">4.10 diff算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第五章 编译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter5/5-1.html" class="sidebar-link">5.1 初探编译器</a></li><li><a href="/./main/chapter5/5-2.html" class="sidebar-link">5.2 从入口开始</a></li><li><a href="/./main/chapter5/5-3.html" class="sidebar-link">5.3 parse之解析模板（上）</a></li><li><a href="/./main/chapter5/5-4.html" class="sidebar-link">5.4 parse之解析模板（下）</a></li><li><a href="/./main/chapter5/5-5.html" class="sidebar-link">5.5 parse之生成AST（1）</a></li><li><a href="/./main/chapter5/5-6.html" class="sidebar-link">5.6 parse之生成AST（2）</a></li><li><a href="/./main/chapter5/5-7.html" class="sidebar-link">5.7 parse之生成AST（3）</a></li><li><a href="/./main/chapter5/5-8.html" class="sidebar-link">5.8 parse之生成AST（4）</a></li><li><a href="/./main/chapter5/5-9.html" class="sidebar-link">5.9 parse之生成AST（5）</a></li><li><a href="/./main/chapter5/5-10.html" class="sidebar-link">5.10 optimize优化</a></li><li><a href="/./main/chapter5/5-11.html" class="sidebar-link">5.11 generate代码生成（1）</a></li><li><a href="/./main/chapter5/5-12.html" class="sidebar-link">5.12 generate代码生成（2）</a></li><li><a href="/./main/chapter5/5-13.html" class="sidebar-link">5.13 generate代码生成（3）</a></li><li><a href="/./main/chapter5/5-14.html" class="sidebar-link">5.14 generate代码生成（4）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第六章 扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter6/6-1.html" class="sidebar-link">6.1 events（1）</a></li><li><a href="/./main/chapter6/6-2.html" class="sidebar-link">6.2 events（2）</a></li><li><a href="/./main/chapter6/6-3.html" class="sidebar-link">6.3 events（3）</a></li><li><a href="/./main/chapter6/6-4.html" class="sidebar-link">6.4 events（4）</a></li><li><a href="/./main/chapter6/6-5.html" class="sidebar-link">6.5 v-model（1）</a></li><li><a href="/./main/chapter6/6-6.html" class="sidebar-link">6.6 v-model（2）</a></li><li><a href="/./main/chapter6/6-7.html" class="sidebar-link">6.7 v-model（3）</a></li><li><a href="/./main/chapter6/6-8.html" class="sidebar-link">6.8 v-model（4）</a></li><li><a href="/./main/chapter6/6-9.html" class="sidebar-link">6.9 slot（上）</a></li><li><a href="/./main/chapter6/6-10.html" class="sidebar-link">6.10 slot（中）</a></li><li><a href="/./main/chapter6/6-11.html" class="sidebar-link">6.11 slot（下）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第七章 内置组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter7/7-1.html" class="sidebar-link">7.1 keep-alive（上）</a></li><li><a href="/./main/chapter7/7-2.html" class="sidebar-link">7.2 keep-alive（下）</a></li><li><a href="/./main/chapter7/7-3.html" class="sidebar-link">7.3 transition（上）</a></li><li><a href="/./main/chapter7/7-4.html" class="sidebar-link">7.4 transition（中）</a></li><li><a href="/./main/chapter7/7-5.html" class="sidebar-link">7.5 transition（下）</a></li><li><a href="/./main/chapter7/7-6.html" class="sidebar-link">7.6 transition-group</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第八章 Vue-router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter8/8-1.html" class="sidebar-link">8.1 vue-router的注册</a></li><li><a href="/./main/chapter8/8-2.html" class="sidebar-link">8.2 VueRouter实例化</a></li><li><a href="/./main/chapter8/8-3.html" class="sidebar-link">8.3 动态路由</a></li><li><a href="/./main/chapter8/8-4.html" class="sidebar-link">8.4 match</a></li><li><a href="/./main/chapter8/8-5.html" class="sidebar-link">8.5 导航守卫（上）</a></li><li><a href="/./main/chapter8/8-6.html" class="sidebar-link">8.6 导航守卫（中）</a></li><li><a href="/./main/chapter8/8-7.html" class="sidebar-link">8.7 导航守卫（下）</a></li><li><a href="/./main/chapter8/8-8.html" class="sidebar-link">8.8 路径切换</a></li><li><a href="/./main/chapter8/8-9.html" class="sidebar-link">8.9 router-view组件</a></li><li><a href="/./main/chapter8/8-10.html" class="sidebar-link">8.10 router-link组件</a></li><li><a href="/./main/chapter8/8-11.html" class="sidebar-link">8.11 history模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-7-异步组件"><a href="#_3-7-异步组件" class="header-anchor">#</a> 3.7 异步组件</h1> <p>  这个小节我们来介绍vue的异步组件，异步组件的渲染是非常巧妙的，它实际上是通过多次渲染来实现的。先渲染为一个注释节点，等组件加载完成后进行重新渲染从而实现一个异步加载过程。那为什么要使用异步组件呢？Vue一个值得诟病的地方就是首屏加载时间长，因为它所有的组件要在一个js文件中加载出来，但实际上很多组件我不需要首屏时就展示到页面上，为了减少首屏包体积，我们可以使非首屏展示的组件去异步加载来达到目的。所以我们下面来学习异步组件的实现原理。<br>
  异步组件分为三种：工厂函数、promise和高级异步组件，下面我们来分别介绍这三种方式的异步组件。下面我们来介绍如何使用工厂函数来实现一个异步组件</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这个特殊的require告诉webpack</span>
  <span class="token comment">// 自动将编译后的代码分割成不同的块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'@/components/HelloWorld'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>  我们还是通过<code>Vue.component</code>方法创建去异步组件，只不过第二参数我不是传入一个组件对象，而是一个工厂函数，通过<code>require</code>方法去找组件路径，然后<code>resolve</code>返回结果。下面我们来看看传入一个函数时<code>Vue.component</code>的调用会有什么不同。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
      <span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
      <span class="token literal-property property">definition</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id
          definition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          definition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">bind</span><span class="token operator">:</span> definition<span class="token punctuation">,</span> <span class="token literal-property property">update</span><span class="token operator">:</span> definition <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
        <span class="token keyword">return</span> definition
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>  可以看到在<code>definition</code>是一个对象时会将<code>definition</code>转化为一个构造器，而如果是一个<code>function</code>时其实没有去做过多的操作的，只是最后直接将这个其添加到<code>components</code>中，从它们的创建过程我们好像看不出有明显得不同，那么后面去看它们在执行过程中有什么不同。<br>
  在<code>_createElement</code>函数中我们还是可以正常调用<code>resolveAsset</code>方法返回<code>Ctor</code>的，只不过它是一个工厂函数，然后我们执行<code>createComponent</code>就真正体现出了差异。我们来看下面这一段代码</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// async component</span>
  <span class="token keyword">let</span> asyncFactory
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    asyncFactory <span class="token operator">=</span> Ctor
    Ctor <span class="token operator">=</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>asyncFactory<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Ctor <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// return a placeholder node for async component, which is rendered</span>
      <span class="token comment">// as a comment node but preserves all the raw information for the node.</span>
      <span class="token comment">// 返回异步组件的占位符节点，该节点呈现为注释节点，但保留该节点的所有原始信息。</span>
      <span class="token comment">// the information will be used for async server-rendering and hydration.</span>
      <span class="token comment">// 这些信息将用于异步服务器渲染和混合。</span>
      <span class="token keyword">return</span> <span class="token function">createAsyncPlaceholder</span><span class="token punctuation">(</span>
        asyncFactory<span class="token punctuation">,</span>
        data<span class="token punctuation">,</span>
        context<span class="token punctuation">,</span>
        children<span class="token punctuation">,</span>
        tag
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>  这是<code>createComponent</code>方法中有关异步组件的一段逻辑，它通过判断<code>Ctor.cid</code>不存在来确定这是一个异步组件，因为一个构造器是肯定会有cid属性的，在这之前Ctor如果是对象形式传入的话它会被转化为一个构造器，所以Ctor必定是个函数，而cid则可以区别工厂函数和构造函数。这里创建<code>asyncFactory</code>变量来保存Ctor，而Ctor则被修改为<code>resolveAsyncComponent</code>的返回值，这就走到了我们的关键性逻辑了，这个方法被定义在<code>vdom/helpers/resolve-async-component.js</code>中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">resolveAsyncComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter">factory<span class="token punctuation">,</span>
  baseCtor</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>errorComp
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved
  <span class="token punctuation">}</span>
</code></pre></div><p>  可以看到这个函数非常复杂，但是不要慌我们一步步来分析它。首先还是看它接收的参数，第一个参数是<code>factory</code>，也就是工厂函数，我们传入的是<code>asyncFactory</code>，也就是我们定义的工厂函数；第二参数是<code>baseCtor</code>，这个在<code>createComponent</code>函数中很容易就可以找到它就是Vue。<br>
  接下来我们看它的逻辑部分，开头执行了两个if判断，但是仔细一看都是基于<code>factory</code>属性的判断，我们并没有给它添加这些属性，所以这里断言它们都是<code>undefined</code>，那么就可以直接跳过这部分逻辑直接看下面内容。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> owner <span class="token operator">=</span> currentRenderingInstance<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>owner <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>owners<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> factory<span class="token punctuation">.</span>owners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>owner<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// already pending</span>
    factory<span class="token punctuation">.</span>owners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loadingComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loadingComp
  <span class="token punctuation">}</span>
</code></pre></div><p>  接下来是定义<code>owner</code>变量，并赋值为<code>currentRenderingInstance</code>，这个很长的变量意思很明确就是当前正在render的实例，它是在<code>render.js</code>被赋值为vm的。然后这个有关<code>factory</code>一些属性判断肯定也不存在，直接跳过这段逻辑再往下看：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span>owner <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>owners<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> owners <span class="token operator">=</span> factory<span class="token punctuation">.</span>owners <span class="token operator">=</span> <span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sync <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> timerLoading <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> timerTimeout <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token punctuation">;</span><span class="token punctuation">(</span>owner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'hook:destroyed'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">remove</span><span class="token punctuation">(</span>owners<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  这是一个很长的判断逻辑，它是直接到函数结束的，为了方便我们把它也拆开来分析，这里判断<code>factory.owners</code>不存在显然是<code>true</code>，然后给<code>factory.owners</code>赋值为<code>[owner]</code>，然后就是又声明一些变量，然后就是监听组件的<code>destroyed</code>生命周期的执行，然后把<code>owner</code>从<code>owners</code>中移除。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">forceRender</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">renderCompleted</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> owners<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>owners<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>renderCompleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      owners<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timerLoading <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerLoading<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timerLoading <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timerTimeout <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timerTimeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>  这里定义了一个<code>forceRender</code>方法，可以看到这个方法被多次调用，说明这是一个十分关键的方法。它只接收一个参数<code>renderCompleted</code>，内部逻辑是遍历了<code>owners</code>数组并分别调用它们的<code>$forceUpdate</code>方法去更新。然后再判断<code>renderCompleted</code>存在的话，先将<code>owners</code>置为空数组，然后下面判断<code>timerLoading</code>不是<code>null</code>就去清除这个定时器并将<code>timerLoading</code>重置为<code>null</code>，下面<code>timerTimeout</code>也是一样的逻辑。<br>
  在这里我们可以先看一下<code>$forceUpdate</code>方法，这个方法我们应该不会陌生，这个方法主要与<code>watch</code>有关，我们现在还没办法去深入讲解它，但是可以简单了解一下。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  可以看到这个方法定义十分简单，先定义vm为this，判断<code>vm._watcher</code>是否存在，这属性我们之前其实有提到，在创建渲染<code>watcher</code>时候才会在vm上添加这个属性，然后就执行<code>vm._watcher.update</code>方法，回归正题我们接着往下看</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> resolve <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// cache resolved</span>
      factory<span class="token punctuation">.</span>resolved <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// invoke callbacks only if this is not a synchronous resolve</span>
      <span class="token comment">// (async resolves are shimmed as synchronous during SSR) 仅当这不是同步解析时才调用回调（异步解析在SSR期间填充为同步）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        owners<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  这里定义了<code>resolve</code>方法，<code>once</code>是一个闭包函数，<code>resolve</code>这里是拿到<code>once</code>函数所返回的内层函数，这里<code>once</code>的作用是保证传入的函数只会执行一次，这个定义在<code>shared/ util.js</code>的方法我们也是把它收录在util中。那我们就着重分析传入的这个函数吧，它先给<code>factory.resolved</code>赋值，然后<code>if</code>判断<code>sync</code>如果是<code>false</code>就执行<code>forceRender</code>方法重新加载，否则就将<code>owners</code>置为空数组。</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> reject <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Failed to resolve async component: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token punctuation">(</span>reason <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot;\nReason: &quot;</span> <span class="token operator">+</span> reason<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        factory<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  同样用<code>once</code>方法创建<code>reject</code>函数，这个方法主要是返回一些报错信息，还有就是在<code>factory.errorComp</code>存在时将<code>factory.error</code>置为<code>true</code>然后执行一次更新方法。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  这里就是去执行我们写的<code>factory</code>函数了，也就是去执行我们的<code>require</code>方法，这是与<code>webpack</code>相关的一个异步方法，而我们的js是单线程的，它会继续往后执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  因为这个时候<code>res</code>还没有返回值，我js 代码会先执行同步的逻辑，所以这个大的if判断逻辑也不会走到，这就直接走到了我们最后的逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code>    sync <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// return in case resolved synchronously在同步resolve的情况下返回</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loading
      <span class="token operator">?</span> factory<span class="token punctuation">.</span>loadingComp
      <span class="token operator">:</span> factory<span class="token punctuation">.</span>resolved
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  最后我们把<code>sync</code>置为<code>false</code>，最后<code>return</code>时这几个属性都是没有，所以返回的是<code>undefined</code>。<br>
  然后回到我们<code>createComponent</code>方法中，我们得到<code>Ctor</code>是<code>undefined</code>，然后下面就是判断<code>Ctor === undefined</code>成立的话就返回并执行<code>createAsyncPlaceholder</code>，这里注释说是返回异步组件的占位符节点，但是保留这个节点的原始信息。那么下面我们看这块逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createAsyncPlaceholder</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">factory</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token operator">?</span>string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  node<span class="token punctuation">.</span>asyncFactory <span class="token operator">=</span> factory
  node<span class="token punctuation">.</span>asyncMeta <span class="token operator">=</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag <span class="token punctuation">}</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><p>  可以看到这个方法也是超级简单，通过<code>createEmptyVnode</code>方法创建一个空的注释节点，这个方法是专门用来生成注释节点的，如果不传<code>text</code>就是一个空注释节点，这里是用一个空的注释节点来当异步组件的占位节点，但是后面使<code>node.asyncFactory = factory</code>，然后又在<code>node.asyncMeta</code>添加<code>data、context、children、tag</code>等信息，也就保存了组件的原始信息，最后生成vnode就是下面这个样子
</p><div class="center"><img src="data:image/png;base64,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"></div><p></p> <p>  执行完这个方法后也就完成了<code>createComponent</code>，然后回到<code>_createElement</code>方法中再把生成的<code>vnode</code>返回出去，然后回到<code>vm._render</code>方法中进行一个收尾工作后再次返回<code>vnode</code>，这样就去执行我们<code>vm._update</code>方法了，这个挂载流程我们分析过很多次了，我们应该是非常熟悉了。然后就是我们的<code>patch</code>过程了，这里<code>patch</code>时可以看到<code>createElm</code>的<code>vnode</code>就是我们这里的注释<code>vnode</code></p><div class="center"><img src="data:image/png;base64,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"></div><p></p> <p>  可以看到这里<code>isComment</code>为<code>true</code>，<code>text</code>和<code>tag</code>为空和<code>undefined</code>，这里会走<code>else if</code>逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  这里创建了一个空的注释节点，这里创建的是真实<code>dom</code>节点，然后我们就可以看到多出了一个空的注释节点
</p><div class="center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASUAAAA3CAMAAAB90KxhAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHaUExURf/////ppVJ1hMb/////xoR1UqXp///ThACjxlKLpef//wCLpf//56WLAFK756WLUqXp/sajAYTT/gB1hFJ1Uue7UoR1AITT/wGLpeb//6WLAVK75v7//wGjxcajAAB1AAB1UlN1AMX//4R1AaTp/v//zqcSkLrl/7phgIhhtej////opaZFAKaw59eSANGLgOj/zqcSgJes5+iskIgSodH/54iLzv/LoafL///ltZcSodH//4gSgIgSkJlFALPN/+mvsBoaqGSv6MyPqJHN1ZEaqBoau8z//2Sv1a5mqBoasK7m/5cSgMRuAJmSxv//1ZEau5HN/xqP1acSobphkLNFUsTo///Nu//mx2Rmx+n//5dhtZEasJcSkJeLzuuwUmQasP//6KfL5xqPx65msM/o/M/oxGt1UYbW/Jept7XK3Mff8n2KlmZxenN/ir7V56a6yqGbAEOw5M/Wo0N1gqHo/M/o5IaHAACbxM/DggB1UXyKloWToGt1AEN1AGvD/Mvj94ubqJ2vvoaHggCHo7zo/AB1grywUZGisFJ1AIR1hMbThFK7xqWjAAF1AOe7U6WLU6WLhMb/56W7hISjxgCjxQGjxlN1AYPT/sbppYS758ajhFOLpQAAALRGSVAAAACedFJOU/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8APofj+AAAAAlwSFlzAAAOxAAADsQBlSsOGwAABd1JREFUeF7tm+9P20YYx22ULkWI7cVG0N7YY5JLEC0ZhJIxRYyUqQytKFurql0m0ZopsAQZUgqMEMGSlbKpmkSrbRLb+sfueZ57rPgc25i1IIf5g5z7Yd9zd997nnNAnBIN1K15TIwr71DRTfIqJerrEqWhSfaVFLP/XS61YUPmS2d3dkn7gZIIovYEq/Q+3VY/8L7tyzGoZKQ6Z43qAXJ3tpyaWJIIwr6U8FFJ0fRNTI71s83A7Nd10dKJkfqIutF02cvUIVoM+3ZMTExMTExMTHiMa8/hu0d6xOObr3r9BufG7IyiZEY+GZ/gfAfZyZvpKc5L5IR96qzo2Vm0Ma4Nn0mlLKj0Kec7yIFKnhJmRJOAziJKRkyHBn4aTpWmzLS/SiMlNDv9GX3bBtj6KFcYdzo642FEE5MiwxjP5/PDSi6fh5KBPtKeoDI2M0NyQDrTVomZLRQKtxRl7ovJwu15ZfbLhULB8dU/B0aR0TtC0CxKIXeGd1ToTAwkmhi0t6Auxj2cUBaHih+UYczFz+FzbAmuCSUDU8xLoWJ8Pa/MgTZzt0CzQWX2Ltcj0yRPblKIZdwD6X07y0Q1AHN5WmPcU0VM0HhhMmZazIswF+Ep4z5suI6IYx6ALwmFlAd3SaGH30oSjk8pmUn2S7Lu31mWPS9yCF9yDRz22OnvHFMlX0rcL5NKsi8VJwfh+spXJfYlMX2hhm9nkfUl3pdG88NmmmYiBj66lCUfY0glc3FCedSxLz18PKzM3iZfMhdEtKFgNva+xGIJ496dFSO8LwH4csnm88uw0JDQliq9o81F2LVh/1avzyw96oi4uULh+wXwJbGJ417u2Jbkd5yZ/oby3p1F+h33lmAHknZuNxhq/2/CqBQTqxQT06Zs0zyPn7eM0/SF/DBtlWL8iVUKQ6xSGGKVwhBCpZXVE869MZUqZ7qMi1Op2WxYlrVRLtcsq7HGlV1CsEpPNuEjhEpPt7Y5589aY7lagbQGElVqoq5bCFJpJ7WLSRhfqu+d+szG+gYGXLOxAYKhXF1EgEor++hJpNIOZYJ4evAT50CPRo9l9fzcbGHyK1fCpkSBVm01a43KpVGprvO8d55hOK3s6/rhc/AvXT+C8i+6jvfr+P9B9NTKPjmehEvcqmXVyrVWq3aZIs72pVA4fQm2Z8t61gRRLGvd8VarVMGRKusb4GywiXcTgfvSj+QeTgH8qO8Nck7g+j2IWGutQaTVKuUmeFN3EaQSv+NCqBTiHbeMnlUB5VoYd11GsEpvBrpS252alarsW13EeaokAwHHue7jvFXqWveRuDhf6mZilcLAf9eNiYmJiblsJFa3OddBxy3t6GMFTxLteTVRD6g+qZ9AQdMpOQXJntxkYJcz/wEy20Yd6jj3dGZ8j2N53NLEQTaD6ov9kg7F/kFKkzqlJhcDkezJTUKplFj1HDubtVEPOg8a+rT0QkONz6ISk7iCa2/KKvFUbVx3AxH25CYDf3ImiICxn0LolsV+Wq4glV7UdR0eQjXhgpAShxhpIQZ0YM9um9jH4i7MlOt4yhBGh9AmiX/OwzKSxH6LL7dle26VfhOW4CFHIGIJ7KGjwQXGdf1onmrbQcVm1d4n2LKIJw3RR3kk4lm7JQ6709EcGClhmBfSCyPVVzLgtgaG8FKShx9ivRDWFVO2L2EDQEx5APqAq/ieuCdQe0vaifECokKy51IJpgZCJOAxw5K2Ge3EVon7xJOsRsoxGDKrHuwqyT6yr8E9Hok6JJ4TLU0Yl3y61wVvH7CorzCIUVSQGpUHiRlaY+iCfIlU4rX3Usn2SeeU6cgoHjOVTocmrJu//6H2wgQkey6VQAT1dQmdUG8fIU2koLhJ4YiXaEi+SeNjyCyeFebzwjAFeyRoFhEt1SGsDTrubKQcdr0hU6gSPEl7WBJ91u7CV6W2LznW6RhDV2C++uvvf+pYlOx5qNRbIgXaaFCE0di+JBoKlURkEGQWzwqrW+SFqBKPxKVSLzyoKP8CvHmr+U6vaFwAAAAASUVORK5CYII="></div><p></p> <p>  执行完<code>createElm</code>方法后又会删除旧节点也就是我们的<code>div id = app</code>的节点，这时我们页面上只有一个空的注释节点了。页面挂载完毕后我们开始执行我们异步逻辑，也是我们工厂函数<code>resolve(res)</code>，<code>res</code>如下所示：
</p><div class="center"><img src="./assets/img/3.7.3.33d13ce5.png"></div><p></p> <p>  那么来看<code>resolve</code>方法中执行的<code>ensureCtor</code>函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ensureCtor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">comp</span><span class="token operator">:</span> any<span class="token punctuation">,</span> base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    comp<span class="token punctuation">.</span>__esModule <span class="token operator">||</span>
    <span class="token punctuation">(</span>hasSymbol <span class="token operator">&amp;&amp;</span> comp<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'Module'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    comp <span class="token operator">=</span> comp<span class="token punctuation">.</span>default
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span>
    <span class="token operator">?</span> base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span>
    <span class="token operator">:</span> comp
<span class="token punctuation">}</span>
</code></pre></div><p>  结合我们返回的<code>res</code>这块逻辑就显得很简单了，这就是我们为什么把它放到这里来分析，它接收的第一个参数就是我们的<code>res</code>，第二个参数是一路传递过来的<code>Vue</code>构造器。然后来看执行逻辑，首先if逻辑是肯定可以走到的，所以这里<code>comp</code>等于<code>comp.default</code>也就是得到组件配置选项，然后返回一个三元表达式，如果<code>comp</code>是对象就返回<code>base.extend</code>方法创建的构造器，否则就返回<code>comp</code>。<br>
  然后就回到我们<code>resolve</code>方法中，我们上次执行<code>resolveAsyncComponent</code>时最后把<code>sync</code>设置为<code>false</code>，所以我们这里<code>if(!sync)</code>逻辑会执行到，然后就调用<code>forceRender</code>去更新，这个方法最后会执行到我们<code>observe/scheduler.js</code>中的<code>flushSchedulerQueue</code>方法，最后其实是调用了<code>watcher</code>的<code>get</code> 方法，这就又开始执行<code>updateComponent</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>  这又回到我们熟悉的流程了，与之前流程没有什么不同，执行<code>vm._render</code>，然后执行<code>_createElement</code>方法，直到再次执行<code>createComponent</code>方法中的异步组件逻辑时才有所不同，也就是再次执行<code>resolveAsyncComponent</code>方法时候有所不同，因为我们在工厂函数上添加了一些属性，我们之前跳过的一些判断逻辑会执行了，这时的工厂函数是这样的
</p><div class="center"><img src="data:image/png;base64,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"></div><p></p> <p>  我们看到<code>owners</code>是个空数组了，你是不是非常奇怪为什么它变成了空数组呢？因为之前它是有元素的，我们在分析过程中也没有发现在哪里修改了它，唯一没有完全分析的只有<code>$forceUpate()</code>方法，作为一个更新的公共方法去修改<code>owners</code>数组貌似不太可能，当然我们不能凭感觉去分析，我们在调用<code>$forceUpate()</code>时候并没有传入参数，所以它是不可能去访问到<code>owners</code>数组的。所以真相变得扑朔迷离起来了，实际上问题就是出在<code>$forceUpate()</code>身上，因为它内部也异步执行的，所以这里会先执行完<code>forceRender</code>函数剩余的逻辑才执行更新，我们在<code>resolve</code>中调用<code>forceRender</code>方法传入的是<code>true</code>，于是它会执行下面这段逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>renderCompleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    owners<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>renderCompleted</code>就是我们传入的参数，可以看到它将<code>owners</code>数组置空了。了解了这个之后我们就可以继续往下分析了。<br>
  之前我们说到再次执行<code>resolveAsyncComponent</code>会有不同的逻辑，我们就来看看第一个不同之处</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved
<span class="token punctuation">}</span>
</code></pre></div><p>  这时候<code>factory.resolved</code>是存在的，所以这里直接返回了<code>factory.resolved</code>，也就是构造器<code>Ctor</code>，这时就回到了我们的<code>createComponent</code>方法中了</p> <div class="language-js extra-class"><pre class="language-js"><code>Ctor <span class="token operator">=</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>asyncFactory<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
</code></pre></div><p>  这里的<code>Ctor</code>不是<code>undefined</code>后<code>createComponent</code>方法就可以正常做事了，然后返回组件占位节点然后再去<code>patch</code>将组件内容挂载到页面上。<br>
  上面我们讲解了使用工厂函数来实现异步组件，那么接下来我们就讲解另外两种异步组件的实现。<br>
  下面我们来分析通过<code>promise</code>方式实现异步组件，通过对工厂函数实现的异步组件的学习，我们接下来的学习将会简单的多。<br>
  来看下面的<code>dome</code></p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">,</span> 
  <span class="token comment">// import函数会返回一个promise对象</span>
<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/HelloWorld'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>  这个执行过程和工厂函数的实现大致相同，同样执行会<code>resolveAsyncComponent</code>方法，而且其前面逻辑基本相同，到最后才有所差异</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// () =&gt; Promise</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  差异从我们的<code>factory</code>函数的执行后开始，因为我们这次<code>factory</code>函数是有返回值的，因为<code>import</code>函数会返回一个<code>promise</code>对象，这意味着<code>res</code>是个对象，所以这里直接执行下面<code>if</code>逻辑，这里<code>isPromise(res)</code>也是<code>true</code>，所以执行里面逻辑。先判断<code>factory</code>的<code>resolved</code>属性是<code>undefined</code>的话就调用<code>res.then(resolve, reject)</code>，也就是将我们的<code>resolve</code>和<code>reject</code>方法传入。然后代码继续执行就和之前的工厂函数一样，创建一个注释节点插入到页面，等<code>promise</code>返回结果时执行<code>resolve</code>方法，之后就是重新渲染的过程了。到这里我们<code>promise</code>方式创建组件方式我们就分析完了，接下来我们来看高级异步组件的实现。<br>
  先上我们的<code>dome</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> LoadingComp <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div&gt;loading&lt;/div&gt;'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ErrorComp <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div&gt;error&lt;/div&gt;'</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 需要加载的组件，应当是个promise</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/HelloWorld'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 加载时渲染的组件</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> LoadingComp<span class="token punctuation">,</span>
  <span class="token comment">// 出错时渲染的组件</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> ErrorComp<span class="token punctuation">,</span>
  <span class="token comment">// 渲染加载中组件前等待的时间。默认：200ms。</span>
  <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
<span class="token comment">// 最长等待时间。超出此时间则渲染错误组件。默认：Infinity</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'HelloWorld'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>  可以看到我们<code>factory</code>执行后会返回一个对象，这意味着在<code>resolveAsyncComponent</code>它也是会执行<code>if(isObject(res))</code>中逻辑，但是这里<code>res</code>不是<code>promise</code>的，所以执行<code>else if</code>的逻辑，因为它的<code>component</code>是一个<code>promise</code>，所以就把<code>resolve</code>和<code>reject</code>传递给<code>res.component.then</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>component<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      factory<span class="token punctuation">.</span>errorComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      factory<span class="token punctuation">.</span>loadingComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>delay <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        timerLoading <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          timerLoading <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>delay <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timerTimeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        timerTimeout <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>
            process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
              <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">timeout (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>timeout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms)</span><span class="token template-punctuation string">`</span></span>
              <span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  再之后就判断<code>error</code>是否存在，这个是加载组件出错时渲染的组件配置，它就是给函数<code>factory</code>添加<code>errorComp</code>属性为<code>res.error</code>生成的构造器，下面同样的<code>res.loading</code>也是一样道理去添加<code>factory.loadingComp</code>,但是<code>loading</code>选项还有<code>delay</code>配置，这是延时选项，单位为毫秒。如果超过这个时间还没加载完成才会显示这个组件直到加载完成。如果它被配置为0就将<code>factory.loading</code>设置为<code>true</code>，否则<code>timerLoading</code>被赋值为一个定时器，定时时间就是<code>res.delay</code>，如果没有设置<code>delay</code>默认是<code>200ms</code>。定时器内部逻辑就是先清空这个定时器，然后再判断如果没有执行<code>resolve</code>并且没有执行<code>reject</code>的话就使<code>factory.loading</code>为<code>true</code>，然后还要执行<code>forceRender</code>的重加载。这里执行重加载时候传入的是<code>false</code>，也就是说这个时候还没<code>resolve</code>，所以不能去清空这些定时器，也不能清空<code>owners</code>数组，这个<code>loading</code>为<code>true</code>有什么影响呢？我们先留个疑问在这里，先继续往下看。<br>
  在往下是对<code>res.timeout</code>判断，它逻辑与<code>res.delay</code>类似，当然它内部判断是不一样的，它是判断如果没有执行<code>resolve</code>方法那么就执行<code>reject</code>方法返回错误，也就是超时了，超时后<code>reject</code>方法执行时判断我们有没有传入<code>error</code>组件，如果传入的话就将<code>factory</code>的<code>error</code>属性设置为<code>true</code>并且触发重加载，然后再次触发<code>resolveAsyncComponent</code>，这样我们第一个判断就派上用场了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>errorComp
<span class="token punctuation">}</span>
</code></pre></div><p>  如果<code>factory.error</code>为<code>true</code>且我们定义<code>error</code>组件那么返回<code>error</code>组件的构造器，这样就渲染出了<code>error</code>组件。可以看到对错误的判断是有最高优先级的。<br>
  然后我们来解决<code>loading</code>的影响，我们看<code>resolveAsyncComponent</code>函数的最后返回</p> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">return</span> factory<span class="token punctuation">.</span>loading
    <span class="token operator">?</span> factory<span class="token punctuation">.</span>loadingComp
    <span class="token operator">:</span> factory<span class="token punctuation">.</span>resolved
</code></pre></div><p>  讲了这么多内容我们是不是忘了最后还有这样一个逻辑，如果<code>factory.loading</code>为<code>true</code>就执行返回<code>loading</code>构造器，我们页面就能直接展示<code>loading</code>组件了，而不是再去创建注释节点了。当然这是同步的情况下，如果我们设置了<code>delay</code>的话它又是一个异步过程了，所以定时器里又去重新加载，这个轮回就依赖于我们上面这段逻辑了</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loadingComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loadingComp
  <span class="token punctuation">}</span>
</code></pre></div><p>  执行这个逻辑返回后渲染我们的<code>loading</code>组件，等我们组件加载完成后执行<code>resolve</code>方法时候再将组件渲染到页面上。到这里我们异步组件就全部分析完毕了。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./main/chapter3/3-6.html" class="prev">
        3.6 组件的注册
      </a></span> <span class="next"><a href="/./main/chapter4/4-1.html">
        4.1 响应式对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.20317d9d.js" defer></script><script src="./assets/js/2.8a65079d.js" defer></script><script src="./assets/js/3.5a34bef2.js" defer></script>
  </body>
</html>
