<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.3 依赖收集（下） | 卷心菜笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./logo.jpg">
    <meta name="description" content="基于vue@2.6.14的学习笔记">
    
    <link rel="preload" href="./assets/css/0.styles.34509ede.css" as="style"><link rel="preload" href="./assets/js/app.cb86b5c8.js" as="script"><link rel="preload" href="./assets/js/2.8a65079d.js" as="script"><link rel="preload" href="./assets/js/11.a8d301ee.js" as="script"><link rel="prefetch" href="./assets/js/10.35fa5c54.js"><link rel="prefetch" href="./assets/js/12.28dadb6d.js"><link rel="prefetch" href="./assets/js/13.959f52a9.js"><link rel="prefetch" href="./assets/js/14.9e967e5c.js"><link rel="prefetch" href="./assets/js/15.89c1bf18.js"><link rel="prefetch" href="./assets/js/16.78f7cadf.js"><link rel="prefetch" href="./assets/js/17.eee5b860.js"><link rel="prefetch" href="./assets/js/18.e94d03e8.js"><link rel="prefetch" href="./assets/js/19.c9b980d9.js"><link rel="prefetch" href="./assets/js/20.82c7f25f.js"><link rel="prefetch" href="./assets/js/21.5878b705.js"><link rel="prefetch" href="./assets/js/22.e7794d4a.js"><link rel="prefetch" href="./assets/js/23.b1e09bbf.js"><link rel="prefetch" href="./assets/js/24.e1df98bf.js"><link rel="prefetch" href="./assets/js/25.1c2fb721.js"><link rel="prefetch" href="./assets/js/26.36c3f7e0.js"><link rel="prefetch" href="./assets/js/27.a3f09949.js"><link rel="prefetch" href="./assets/js/28.123d6383.js"><link rel="prefetch" href="./assets/js/29.04a6e255.js"><link rel="prefetch" href="./assets/js/3.3554c1dd.js"><link rel="prefetch" href="./assets/js/30.f5e711c8.js"><link rel="prefetch" href="./assets/js/31.7ddb232a.js"><link rel="prefetch" href="./assets/js/32.3710a144.js"><link rel="prefetch" href="./assets/js/33.836eb573.js"><link rel="prefetch" href="./assets/js/34.c3f3eb0f.js"><link rel="prefetch" href="./assets/js/35.3e97ba3f.js"><link rel="prefetch" href="./assets/js/36.0ff1be33.js"><link rel="prefetch" href="./assets/js/37.57e976da.js"><link rel="prefetch" href="./assets/js/38.778b591d.js"><link rel="prefetch" href="./assets/js/39.f89500e6.js"><link rel="prefetch" href="./assets/js/4.414ef3ae.js"><link rel="prefetch" href="./assets/js/40.0bb1a72b.js"><link rel="prefetch" href="./assets/js/41.1b14daa9.js"><link rel="prefetch" href="./assets/js/42.da61de9e.js"><link rel="prefetch" href="./assets/js/43.afa151ce.js"><link rel="prefetch" href="./assets/js/44.beed5647.js"><link rel="prefetch" href="./assets/js/45.15cb664e.js"><link rel="prefetch" href="./assets/js/46.19b76064.js"><link rel="prefetch" href="./assets/js/47.81dd06b3.js"><link rel="prefetch" href="./assets/js/48.da28ae74.js"><link rel="prefetch" href="./assets/js/49.6ec02c7d.js"><link rel="prefetch" href="./assets/js/5.7771716e.js"><link rel="prefetch" href="./assets/js/50.33adc7e6.js"><link rel="prefetch" href="./assets/js/51.ad4dcf8f.js"><link rel="prefetch" href="./assets/js/52.1f63a577.js"><link rel="prefetch" href="./assets/js/53.f08905cc.js"><link rel="prefetch" href="./assets/js/54.95edb54c.js"><link rel="prefetch" href="./assets/js/55.4ad5a772.js"><link rel="prefetch" href="./assets/js/56.d55c7dcb.js"><link rel="prefetch" href="./assets/js/57.2bdbd5d4.js"><link rel="prefetch" href="./assets/js/58.6996ec46.js"><link rel="prefetch" href="./assets/js/59.42c770e8.js"><link rel="prefetch" href="./assets/js/6.f0272f8f.js"><link rel="prefetch" href="./assets/js/60.9a43de0b.js"><link rel="prefetch" href="./assets/js/61.9fda2ee3.js"><link rel="prefetch" href="./assets/js/62.40ba97a6.js"><link rel="prefetch" href="./assets/js/63.a8ceda24.js"><link rel="prefetch" href="./assets/js/64.063b5356.js"><link rel="prefetch" href="./assets/js/65.609bfe39.js"><link rel="prefetch" href="./assets/js/66.10bbf1b3.js"><link rel="prefetch" href="./assets/js/67.ed6fbab5.js"><link rel="prefetch" href="./assets/js/68.edf47e53.js"><link rel="prefetch" href="./assets/js/69.58c89969.js"><link rel="prefetch" href="./assets/js/7.44545bae.js"><link rel="prefetch" href="./assets/js/70.44d1903b.js"><link rel="prefetch" href="./assets/js/71.f54eb805.js"><link rel="prefetch" href="./assets/js/72.e0f8bc14.js"><link rel="prefetch" href="./assets/js/73.2292a46a.js"><link rel="prefetch" href="./assets/js/74.259c6d32.js"><link rel="prefetch" href="./assets/js/75.a5535961.js"><link rel="prefetch" href="./assets/js/76.2e270b76.js"><link rel="prefetch" href="./assets/js/77.a4bffe25.js"><link rel="prefetch" href="./assets/js/78.e00f48eb.js"><link rel="prefetch" href="./assets/js/79.dd1ef766.js"><link rel="prefetch" href="./assets/js/8.54165142.js"><link rel="prefetch" href="./assets/js/80.6d018d78.js"><link rel="prefetch" href="./assets/js/81.8647d108.js"><link rel="prefetch" href="./assets/js/82.9c326a94.js"><link rel="prefetch" href="./assets/js/83.0a8e8403.js"><link rel="prefetch" href="./assets/js/84.e1f731e8.js"><link rel="prefetch" href="./assets/js/85.446cc3ec.js"><link rel="prefetch" href="./assets/js/86.7800fc8e.js"><link rel="prefetch" href="./assets/js/87.51a4cddc.js"><link rel="prefetch" href="./assets/js/88.5cb86311.js"><link rel="prefetch" href="./assets/js/89.11fe5589.js"><link rel="prefetch" href="./assets/js/9.2a932dde.js"><link rel="prefetch" href="./assets/js/90.b3555572.js">
    <link rel="stylesheet" href="./assets/css/0.styles.34509ede.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">卷心菜笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./main/" class="nav-link router-link-active">
  正文
</a></div><div class="nav-item"><a href="/./appendix/mergeOptions.html" class="nav-link">
  附录
</a></div><div class="nav-item"><a href="/./util/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/w781223592/vue2.0-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./main/" class="nav-link router-link-active">
  正文
</a></div><div class="nav-item"><a href="/./appendix/mergeOptions.html" class="nav-link">
  附录
</a></div><div class="nav-item"><a href="/./util/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/w781223592/vue2.0-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/./main/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第一章 初识Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter1/1-1.html" class="sidebar-link">1.1 Vue目录设计</a></li><li><a href="/./main/chapter1/1-2.html" class="sidebar-link">1.2 Vue入口文件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第二章 Vue初始化和挂载</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter2/2-1.html" class="sidebar-link">2.1 new Vue()时做了什么</a></li><li><a href="/./main/chapter2/2-2.html" class="sidebar-link">2.2 Vue实例挂载的实现</a></li><li><a href="/./main/chapter2/2-3.html" class="sidebar-link">2.3 Vue挂载时的mountComponent</a></li><li><a href="/./main/chapter2/2-4.html" class="sidebar-link">2.4 Virtual DOM</a></li><li><a href="/./main/chapter2/2-5.html" class="sidebar-link">2.5 最终的挂载方法_update</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第三章 组件化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter3/3-1.html" class="sidebar-link">3.1 创建组件vnode</a></li><li><a href="/./main/chapter3/3-2.html" class="sidebar-link">3.2组件的patch过程</a></li><li><a href="/./main/chapter3/3-3.html" class="sidebar-link">3.3合并配置</a></li><li><a href="/./main/chapter3/3-4.html" class="sidebar-link">3.4生命周期（上）</a></li><li><a href="/./main/chapter3/3-5.html" class="sidebar-link">3.5生命周期（下）</a></li><li><a href="/./main/chapter3/3-6.html" class="sidebar-link">3.6组件的注册</a></li><li><a href="/./main/chapter3/3-7.html" class="sidebar-link">3.7 异步组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>第四章 响应式原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter4/4-1.html" class="sidebar-link">4.1 响应式对象</a></li><li><a href="/./main/chapter4/4-2.html" class="sidebar-link">4.2 依赖收集（上）</a></li><li><a href="/./main/chapter4/4-3.html" aria-current="page" class="active sidebar-link">4.3 依赖收集（下）</a></li><li><a href="/./main/chapter4/4-4.html" class="sidebar-link">4.4 派发更新</a></li><li><a href="/./main/chapter4/4-5.html" class="sidebar-link">4.5 nextTick</a></li><li><a href="/./main/chapter4/4-6.html" class="sidebar-link">4.6 检测变化的坑</a></li><li><a href="/./main/chapter4/4-7.html" class="sidebar-link">4.7 计算属性</a></li><li><a href="/./main/chapter4/4-8.html" class="sidebar-link">4.8 侦听器</a></li><li><a href="/./main/chapter4/4-9.html" class="sidebar-link">4.9 组件更新</a></li><li><a href="/./main/chapter4/4-10.html" class="sidebar-link">4.10 diff算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第五章 编译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter5/5-1.html" class="sidebar-link">5.1 初探编译器</a></li><li><a href="/./main/chapter5/5-2.html" class="sidebar-link">5.2 从入口开始</a></li><li><a href="/./main/chapter5/5-3.html" class="sidebar-link">5.3 parse之解析模板（上）</a></li><li><a href="/./main/chapter5/5-4.html" class="sidebar-link">5.4 parse之解析模板（下）</a></li><li><a href="/./main/chapter5/5-5.html" class="sidebar-link">5.5 parse之生成AST（1）</a></li><li><a href="/./main/chapter5/5-6.html" class="sidebar-link">5.6 parse之生成AST（2）</a></li><li><a href="/./main/chapter5/5-7.html" class="sidebar-link">5.7 parse之生成AST（3）</a></li><li><a href="/./main/chapter5/5-8.html" class="sidebar-link">5.8 parse之生成AST（4）</a></li><li><a href="/./main/chapter5/5-9.html" class="sidebar-link">5.9 parse之生成AST（5）</a></li><li><a href="/./main/chapter5/5-10.html" class="sidebar-link">5.10 optimize优化</a></li><li><a href="/./main/chapter5/5-11.html" class="sidebar-link">5.11 generate代码生成（1）</a></li><li><a href="/./main/chapter5/5-12.html" class="sidebar-link">5.12 generate代码生成（2）</a></li><li><a href="/./main/chapter5/5-13.html" class="sidebar-link">5.13 generate代码生成（3）</a></li><li><a href="/./main/chapter5/5-14.html" class="sidebar-link">5.14 generate代码生成（4）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第六章 扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter6/6-1.html" class="sidebar-link">6.1 events（1）</a></li><li><a href="/./main/chapter6/6-2.html" class="sidebar-link">6.2 events（2）</a></li><li><a href="/./main/chapter6/6-3.html" class="sidebar-link">6.3 events（3）</a></li><li><a href="/./main/chapter6/6-4.html" class="sidebar-link">6.4 events（4）</a></li><li><a href="/./main/chapter6/6-5.html" class="sidebar-link">6.5 v-model（1）</a></li><li><a href="/./main/chapter6/6-6.html" class="sidebar-link">6.6 v-model（2）</a></li><li><a href="/./main/chapter6/6-7.html" class="sidebar-link">6.7v-model（3）</a></li><li><a href="/./main/chapter6/6-8.html" class="sidebar-link">6.8v-model（4）</a></li><li><a href="/./main/chapter6/6-9.html" class="sidebar-link">6.9 slot（上）</a></li><li><a href="/./main/chapter6/6-10.html" class="sidebar-link">6.10 slot（中）</a></li><li><a href="/./main/chapter6/6-11.html" class="sidebar-link">6.11 slot（下）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第七章 内置组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter7/7-1.html" class="sidebar-link">7.1 keep-alive（上）</a></li><li><a href="/./main/chapter7/7-2.html" class="sidebar-link">7.2 keep-alive（下）</a></li><li><a href="/./main/chapter7/7-3.html" class="sidebar-link">7.3 transition（上）</a></li><li><a href="/./main/chapter7/7-4.html" class="sidebar-link">7.4 transition（中）</a></li><li><a href="/./main/chapter7/7-5.html" class="sidebar-link">7.5 transition（下）</a></li><li><a href="/./main/chapter7/7-6.html" class="sidebar-link">7.6 transition-group</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第八章 Vue-router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./main/chapter8/8-1.html" class="sidebar-link">8.1 vue-router的注册</a></li><li><a href="/./main/chapter8/8-2.html" class="sidebar-link">8.2 VueRouter实例化</a></li><li><a href="/./main/chapter8/8-3.html" class="sidebar-link">8.3 动态路由</a></li><li><a href="/./main/chapter8/8-4.html" class="sidebar-link">8.4 match</a></li><li><a href="/./main/chapter8/8-5.html" class="sidebar-link">8.5 导航守卫（上）</a></li><li><a href="/./main/chapter8/8-6.html" class="sidebar-link">8.6 导航守卫（中）</a></li><li><a href="/./main/chapter8/8-7.html" class="sidebar-link">8.7 导航守卫（下）</a></li><li><a href="/./main/chapter8/8-8.html" class="sidebar-link">8.8 路径切换</a></li><li><a href="/./main/chapter8/8-9.html" class="sidebar-link">8.9 router-view组件</a></li><li><a href="/./main/chapter8/8-10.html" class="sidebar-link">8.10 router-link组件</a></li><li><a href="/./main/chapter8/8-11.html" class="sidebar-link">8.11 history模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4-3-依赖收集-下"><a href="#_4-3-依赖收集-下" class="header-anchor">#</a> 4.3 依赖收集（下）</h1> <p>  上一个小节我们从源码层面分析了Vue的依赖分析过程，这个小节我们通过一个小例子来具体分析依赖收集的整个过程。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>  组件App如下：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    hello world{{ b }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'我是app'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token string">'我也是app'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>  可以看到上面是一个十分简单的小例子，首先又是我们<code>new Vue</code>做了什么的那一套逻辑，我想这里可以不必再详细描述了，我们直接从执行<code>mountComponent</code>方法挂载开始说，在这个过程中执行了<code>new Watcher</code>创建我们的观察者，<code>new Watcher</code>时执行到它的<code>get</code>方法，这个在上小节已经说过了，<code>get</code>方法会先执行<code>pushTarget(this)</code>，这个方法就会给<code>Dep</code>类的静态属性<code>target</code>赋值，赋值为我们这里创建的<code>watcher</code>，我们<code>new Watcher</code>时会有</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid <span class="token comment">// uid for batching</span>
</code></pre></div><p>  也就是每个<code>watcher</code>都有唯一的<code>id</code>，那么这里就是<code>id</code>为1的观察者，<code>pushTarget</code>执行完成后就会执行<code>getter</code>函数，<code>get</code>函数就是<code>new Watcher</code>时传入的<code>updateComponent</code>方法，它长面这个样子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>  <span class="token comment">// hydrating 服务端渲染相关</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  是不是回忆起来了呢？然后执行<code>vm._render</code>生成<code>App</code>组件的占位<code>vnode</code>，然后调用<code>vm._update</code>方法，<code>vm._update</code>方法就会执行<code>patch</code>方法去插入节点，<code>patch</code>时发现这是个组件<code>vnode</code>，它就开始初始化子组件，初始化子组件就又是<code>new Vue</code>的这一系列逻辑，这时候有一些不同之处，当然这个不同之处不是<code>Vue</code>带来的，而是我们写的<code>dome</code>带来的，初始化组件时执行<code>initState</code>方法也就是4.1小节讲的那个流程，把<code>data</code>里的数据都处理为响应式的，当然初始化根组件时也执行了<code>initState</code>，但是那里我们没有定义<code>data</code>，所以不需要特别指出这个过程。我们子组件定义了<code>data</code>所以就要特别指出了。
之后还是一样的流程<code>new Watcher</code>生产一个<code>id</code>为2的<code>watcher</code>，然后又执行<code>pushTarge</code>t方法，把<code>Dep.target</code>设置为<code>watcher2</code>(id为2这里就暂且这么去称呼)，同时<code>targetStack</code>中也将<code>watcher2 push</code>进去，再继续执行到<code>vm._render</code>方法，这里因为模板了绑定了'{ { b } }'，实际上会访问<code>this.b</code>，这就触发了<code>get</code>拦截了，这时候<code>Dep.target</code>是<code>watcher2</code>，所以会执行if中逻辑，也就是执行d<code>ep.depend</code>，这个方法又会调用<code>Dep.target.addDep</code>，也就是<code>watcher2.addDep(this)</code>，这里的<code>dep</code>是在<code>defineReactive</code>中定义的<code>dep</code>，如下所示
</p><div class="center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARYAAADACAMAAAD2g7z7AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAECUExURf///xoapiAhJDs8P0REtk9QUlBRU1lZvlpav19jaGFhZGhscWlpxW9vcXF1eXJ1enN3e3Z2ynt+gnx8foSHi4eKjogSgIiJio2Qk4+P05SVlpYvj5aYm5ueoZ+foaFEm6JFm6eprKmqq6pXpa2t36+xs7CytLJmrbW1trhxs7l0tLm7vb6/v8CBu8CDvMPExsaOwsaOw8ePw8jIycrK6srN0cvMzsyZyNGjztGkztfY2dmz1tvb3Nzc8dzd3uDC3uLE4OPI4eXm5+fP5evr7OzZ6+3b7O3t7e7u7u7u7+7u+PLk8fPo8/Tp8/bs9fb29vb29/f3/Pr0+fr2+vz6/P///0pNxPEAAAABdFJOU/4a4wd9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAQGElEQVR4Xu2dDVsbxxHHHZGQKES1HYgUF+qoioOMYzkpcimqZYLbQIXrIgzW9/8qnf/M7N7t3dzpBfQStP8np3vZE0/255m5ndHe3YNRlKGIxVTEYipiMRWxmIpYTEUspgqxNCqVykZfd9ZOxVg2B6PG2nIpxdLfaNFSqTRGw1ptc52MpxTLYLMx2ASZ1rBW6RKaoTbee43D0qUQU6kQFkKCQ2uicU7UrXSxF7GoiMGwtjnob7DnAEt/oyFNa6BiLOQ7IIKQu9Gn2ILIuzYqxBJqncItFLGYilhMTYhl3RSxmGIsf4/KKFqLqYjFVMRiKmIxFbGYilhMGVjOdnuycdnsyMb6aTosrz+DXuvePVaZE9nW8v6bt7p1j5XDctOu12EtWNcJSy5JfPZEN+6zDGu5bBKWm3bzkq0li2UtjKUQCwKM6URrYSxTY3n75ToYSyEWIOkZseXJWhhLHstlk0Jt/XR0Wq+3X+SwrImxWNYSFbEUKGIxFbGYilhMRSymIhZTEYupiMWUYvlFVnl1mpe6Zakrkz10dY+kWB79JOucxmBxNPzGPZHDUn1kG8y6Y6lW1WAoR6y3b27a7Rtk0Z1mG4kjZdNcqyN/4bl0qnXAUv0OW1pk8VjqPViML3uvHxaxFtRwyToSa7kc9XbPLpv13TNuD3T/sTz6p2wxmN2zDBauw+TDzL3Hwg7kBA6d9g2qc4Tlstm+wVGOvuvlRL/LisTVOS7mcnWuwwEYe+xba4ZlRkUspiIWU/d98B8VKmIxlcNS1fV6K2IxFbGYymO52qlWj2hjv1rdk0O301G1unM1Gp1sVR9e6KGsBl+7m0NX5ZYLCwugEBaGQnCs7kij08W3J7pl6ghYCMy3+b+DWyG747C0Fn9/l2D5RUWbWSz0uSfdSuuOsPS/6GNJsJhaGpa/oNxSrSKJNrAcPby4+v7nLfgCuUJ1nz+xHu2xKdEn1vvUfrWzP9r7+SEbGBma2FmAZbCZ6mSjxR+D2nO+5a+ld/7RGneL4k5A3CJJRys4cYESLL+jY1KGsqxlj7q7c0UNJ386GV08pHZppIYRYIi14BNd39s6Ge3tj44AlE8rxDKsIe9sNQabtaFaTJdadRnW9MylWcvoF2DhNNqILbShB7mb1GVpvPqeaKCz6kT7+/iP2+lEtiEGUuhEHguQNDg1BxLcPQoz+VrvL14eltF3rjpnWAtpIiwn3/4LRxwW+TOk4tjinCiDRWoXq4Dld3GhMVjgRFi0p3AiLO4re9gBFhzY9xew4tjSpRBCC7AoBGBpyW3ow5oGlCWk5w7L6CctWpZiwSCEBzUY3KD3zk0kuh5xG7yHDMavS7AguG706Zh/KAqwsBcREhwGEYTepYTclDJYphJdsugTThSo2InyWoLDWLpLLLg6k26DxTvOkmVhmXHwv6fnZ7BMMPhXwVlWw1jyWKKgiMVUxGIqYjEVsZiKWExZWMwJQPitHmv+nT5Qp2hm0MfHn331XrdTctUVTojScg2k/nZ2vO8ah9v+pDnKwmLOGEtjkZlBfJhUiKXgjizNfpA+Y6SSPM3O54acK2XkGxeSIZlYrBljKSx+DpCoCMvHx/YtsJz20D9/bZAZ02oDIfgibxG+UaoRc5aNxc8Yw9ww9FonLsBMds9O+R7P1MwgmSk0aoWPMXz7TcqD+JlbBEGzQNRwfemJ3YmW1tOaVuW44/J8xGzjYtKmIiyuziCzxjoyDwg8yFowYYoYeSwyjyyD5RnumH78UfdgF4gKDfSzKwUF2mzxYF/cqTus0fcBQdxEmWUbl4tFrYVnu3TQeUBA5znk8pyxxFr0aKjAh9BTig4IENRdNgfuIxlRF+6Eo4NNPSq9ZxDsa0HjMrG4GWPa8xwWzMfsjcES+FCLOtSqDWEhKDuhq+gnWhrMjBrBTG2DWwRMppEkcOYrE0vgQL16BwBOyW+o85dNAdCjaJKdRxbGluA6hM6Tw1Af8dhDNhg5GY8S5UZh1iAIHgtvZRqTK/VcZWFJZowh5L5odzBHrPkrJuvW6//4gUIuiWJsOI8sgyW8DlH4rD1tod62+RwdrFSe1waIu5hzhsaXDf9ziGBxMTrTyITnLwvLnei1NZKbTKUdN4Y0c9CcsLz9/BbP7ShzE2tIMwfNzVpuIz90ywnBehFaSSzLV8RiKmIxFbGYilhMjceCke44YRismylly1C+ZFIivThzGUp/ol+GLCxhsWV2LNkylGTG5RJ0MmabBOOcZGEJq3MzY8mVoZAvjhMPWdyYbRFJoS0TS1Kdc88To7yHUsTT3Re8h9tokFO/wA1ZvkY1vgxFTiHzv7oNWlOfMScBhZgu5UpkGVqj8rniJOY1H9lYkjv05HliveYlEmVk0af1Uzwl6Wy3R8hok1JFKb1ksDyzy1DUa1pcNk1eQstgc6OfqlElNFYPi1Tn9MFZbDN1YDnFIc6gfb0FZCwnMstQmB5Imy1a6BDPButy6YVG9YDEEdf7zuphEWvxWKTXHgsqt8yiBItZhtJ+wiZaDecszGzb1agSH1pMDcFUQWzR6hy6zJUmAQEe5DJnuwxBsWAF78o4kV2GkqoAbILCqiv8o/c4QWpUCZaEz8JlYvHVOZT6+XliiKodLfxLyE1quVqjymAxy1AaVOFLOBdrAqUBx9WoViDimlhS1blQ6j0TqawMNaa/6jsLKq2YsrAUanIs5WWoMTFDRrquBr4UzQlLucaN6hF8F/Nbc5GmwrI+ilhMRSymIhZTEYupiMWUhcWcJBYIuRJEw17KrYtUMEksLX9jBA1/XYIIrWJ1rvCxYr4kpVjOdksrVGWP7dYRncOCmkJKq1mdK3qsWLZSVz68y1Xn0gotIfPz6qpW55IylBTgUHBpXkrZRWZDsbUwFrYc3iqpzqULcEgOUWjB+yz5fiG1C04RYUUrkCsWYZEylC/AgQklyc5a9OHuoMTVKEx1yWB5FlTnggIc2YD4x/M+r3lCR6WBBibiaaweFmctvtLEE54CLM6JTlGByXtT4ENagON+wiBch/VHeIk0tMOYvO+sGhZjklgxlpt2rwdjySiozqGDdHXxLuJ+BFACEmnoBGx4HxqXac9RJhZfhlIsqHTnnchhwZQp3i2vzmFBDReLw0EEBi99xB3Uun+Wg9hL81m4LCxJGUqxEAadB0YE+Nl8JCKiWC6bMngpqc4BA4cOuSkT4YSvwQ1e6ZUYbxTmldJYng+ZWKaV2k6oaSaJaf9Tky+hP0x1rkD4FSmjqSaJaanbPzzgj1adM0XX6fxlaAqRYzGOhs6kJMXq3IoqYjEVsZiKWExFLKYiFlMWlvHVufHiXMEUDWlKylOTKpUu5Yt4rlET0RlkYSmuzpXKPdydVYiltDhVJpQfUiw013RjwUCucfakysRSWJ0rkyZIqkIsQWI9hcI7Q5LBXqbcCSWNM2dVNhZ/U16v/e9dpMc8d+6m3an/+CP1HhM6esIB5QaZWIcbr0go1lHLTZvOpKP0Lxb+r6UT6+H28w1Xs6sN+9tPK08xwQV20eUucRrAjT5RoqySFn4kG2xCO07nUJ6abcwWQydXERa9hbO328GteDJ37r9tgnTa6WnPkVoTKTexDnk1+ZDHgoUsJsDy8TFqds90j9IeFC67sHVa+hutxmZ3ewi7oN5qH7WR63v0FWCgBXOIcAJaSMos0zgHLM5a2ASkiEtYemc/nHU6riBFPM52AQCNlC1i/g+/KIGxEBKCJX8mUeBDmiNz0RKzoQa1bleetoZ/c1q3MPvQxRTcmyezzaRwo9ykic/INN45Fv/QfxDwgeImg+WyedqT12rwuSSiOAZLUJwKSpbUqUFt0Gpxh+gQRQjcPaSNEHVS7KbLQVVtQ9oAJtvoCznTy8SSTBITLDp3zmHB7dDUczr8os1xh4MK1EGNimemAgv/jBTGlvA6pKVLrtexG22TvcCE2Ixa3RZ5iDSyWvwoNsq4uwiq/Q1q9ViwlW2kbyRMp5OFJX0Lp2CRuXMOC1+KgeJsl81BJtbhIM6m9a9NcS1crkMsgQ9pYKA1YiybCtuHPnehy2FTGvkTf4hi60syI/dENsECR9PInW6c3YdMLHPUXb/ytbTj1pBmQi0Uy7Oxv0lPrTI3MYY0k2rB1nLnSoZuObkfXWbRHx3LnBSxmIpYTEUspiIWUxaWwjn/89CTzz4f/552VJp43tiiZGH5btIy1LtXH3TLUGmj12s/BSYZrGalwzJfeVqALCyPXP48TneA5YmvMki/9YHTgXRYNnPeN4NsLNVHzpHODw4O3o0+HR8cHF6Pzl/9dnDwRg4ef8Inds8P/3eI1cG5oHhzcPDqg2vUb14fnr/BmixC8iDV+28SD+IUiRPFDZSh+tsvpaLg0kGXQi1CBViqWs9FX0lvDq8/HQPE8Sfq+fUhoYHEIM5fHV/TlsNC56Ya9ZvXh/84//DqXQbLaxSlfD7A+Q2ZBDDQgjvRYCCexipgUT96c/yJPplD0nNYANOSnp+TOfGKG68PeU8b3TevD/kP5ZT2IY6p3dp/kCxTBowiHbB431kBLFqHwj80rTJYcJz8JMHCjLSRbQLixgSLGliotA9x1kfR1SXFSGnUcHj/FmWC6WVj8XWod9zlT8fOiRSLdlq2FcuHV+fXhzCltBO5b3osYWxJX4cQcVGc0XktsA3e9Fj8xgJkYkldiN5R4HxH/+iIsYmf8EHYAodcwYJQ+9vfPnCQFUNBo36zAEvah7jShGswrtOgQyuc62gs0odMLAsbzr39sngk50OK851bVE+ml4VlQXr/VfLTSF6Jy0ilKVXTXYCWiKVcSRGJK02z/5w8k1YWy3IVsZiKWExFLKYiFlMRiykLS3rOj76OR9+mc2vp63jcy35MJeWmhlWUWogsLOnBv768Sd68xO9TzHdHX8ukcq99KpC+vMk6C3UWQlKOZeZf26eSiSU1SSzEQl062uK34qV1R1iQGLp5GMVaJhY/7SePBW+b1PdsyhvhLh6iPEOnyevi8CLG6tYJv09vf+dq/687tCeGxiACLMF0Bu4wfTSe892ekjGKDSFJbKDQi53wjun5qAiLqy3krYV47GHZ51ed4ZWB0ogGwFA7cK8RBKm90cUOAaWlDAtbCaVCjQ33RH8UpjC1A4s8n3w1rYX+yREx5e1m3E00SCNewInOKpaT76/oP/4+rWFJbDUlTuSx0FpSIGDhSWIbydtulxpb3CSxvLVAk2ChFY44LPJnSMVYvBOFWATDKmBJJomVYYETsSPJYTgRv1hR35R3tANs+D4dONlyFAIsgRO52WGERUtOwKLTvXy5ZTE1OgtLugxVgoWir75jcI/XFGzFTbZ4ffEQbfoqXI7H6b9hYGF/IQYUWzWoStGbduksFO9wvcZaWucpC0taAZapxC9Idt9PFGAZo8VYhqX5YcGLom+JZaF1ykBjscw4+D/Sd25msEwy+FeRLy3NWMZiWVNFLKYiFlMRi6mIxVTEYipiMRWxmIpYTEUspiIWUw+i8nrw4P/Psz4gADexYAAAAABJRU5ErkJggg=="></div><p></p> <p>  可以看到它已经排行老7了，因为<code>new Dep</code>的地方比较多，我们也不必深究为什么它是老7。我们只要知道它长什么样子就可以了。<code>addDep</code>方法执行呢就会往<code>watcher2</code>的<code>newDepIds</code>中添加<code>dep.id</code>，往<code>newDep</code>中添加<code>dep7</code>，最后如果旧的<code>depIds</code>中没有<code>id为7</code>的值，就执行<code>dep.addSub(this)</code>，实际上就是将<code>watcher2</code>添加到<code>dep7</code>的<code>subs</code>中，这样<code>watcher2</code>就做为订阅者去订阅这些数据的变化，一旦数据发生改变就可以通知订阅者去更新数据。<br>
  这里还有个新旧<code>dep</code>的概念，包括<code>deps、depIds、newDeps、newDepIds</code>，我们先继续往下看，说了这么多其实它就是执行了<code>this.b</code>的<code>get</code>拦截而已，它的结果其实就是取到了<code>b</code>的值<code>'我是app'</code>，然后完成<code>render</code>过程，再完成<code>patch</code>过程，最后其实也就是完成了<code>updateComponent</code>，也就是完成了<code>watcher2</code>的<code>get</code>函数的一部分，这里我们再回顾一次<code>watcher</code>的<code>get</code>函数执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> value
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
  value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>  我们上面分析那么其实都是在执行执行完成了<code>this.getter.call</code>，再往下执行是<code>popTarget</code>，这部分是我们上节没有讲到的，我们来看一下<code>popTarget</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  targetStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> targetStack<span class="token punctuation">[</span>targetStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  这里执行完<code>watcher2</code>之后就将<code>targetStack.pop()</code>，这样堆栈中就只剩<code>watcher1</code>了，这是再重新把<code>Dep.target</code>设置为上一个<code>watcher</code>，在这里也就是<code>watcher1</code>，关于<code>Vue</code>这种先子后父的顺序是贯穿整个<code>Vue</code>执行过程的，关于保存当前正在执行的内容也是很多地方都有体现，在不同场景下也是通过不同方法去保存的，这里是通过堆栈的方式去保存<code>watcher</code>的。<code>currentRenderingInstance、activeInstance</code>其实也都是类似的思路，但是他们是通过局部变量保存的。
再接着往下看执行<code>this.cleanupDeps</code>，我们再看这里做了什么事</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">cleanupDeps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depIds
  <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> tmp
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps
  <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> tmp
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>先获取<code>this.deps</code>数组长度并定义<code>i</code>保存，通过<code>while(i--)</code>循环直到<code>i</code>为0为止，这个循环做了什么事呢？这里就与我们之前提到的新旧<code>dep</code>的概念有关了，这里先要判断新的<code>dep</code>的<code>id</code>列表<code>newDepIds</code>中没有<code>dep.id</code>，说明这个旧的依赖不需要了，就调用<code>dep.removeSub(this)</code>把观察者<code>watcher</code>从<code>dep</code>的<code>subs</code>中删除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sub</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  我们<code>removeSub</code>方法就是执行了<code>remove</code>方法，<code>remove</code>方法详见util文档。<br>
  接下来定义<code>tmp</code>保存<code>this.depIds</code>，然后将<code>this.depIds</code>设置为<code>this.newDepIds</code>，将<code>this.newDepIds = tmp</code>，也就是将新旧<code>id</code>数组互换，然后执行<code>this.newDepIds.clear</code>将数组清空，然后对<code>deps</code>和<code>newDeps</code>也执行相同的操作。这个方法就是将旧的依赖收集换成新的依赖收集，然后再将新依赖收集全部清空等待下一次重新收集新依赖。<br>
  这里为什么要这样做呢？我们简单改一下<code>App.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    hello world
    {{ isB ? b : c.d }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">isB</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'我是app'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token string">'我也是app'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>  在这里我们依赖是有分支切换的，<code>isB</code>为<code>true</code> 的时候，依赖项其实<code>b</code>，若修改<code>isB</code>为<code>false</code>的时候，依赖项是<code>c.d</code>，这个时候要修改<code>c.d</code>的值的话肯定会触发页面更新，但是如果我们修改<code>b</code>的值呢？<code>b</code>已经不在页面上显示了，如果我们没有执行<code>clearupDeps</code>方法的话，它其实也不会报错，而是会触发一次更新，因为<code>b</code>已经不显示了，我们对这次更新是无感知的，但它是实实在在发生的。为了避免这种不必要更新的情况，这里通过重新收集依赖并替换旧的依赖方式来解决。<br>
  到这里我们依赖收集的内容就都讲完了，可能你还是没有明白<code>dep</code>是什么？为什么这么定义，收集这个有什么用？<code>watcher</code>又是什么？它为什么能做观察者或者订阅者的？尽管整个收集过程我们已经很清楚了，但是这么设计理由是什么我们不清楚，这么设计有什么用也不清楚。不要着急，这是因为我们不知道它是怎么实现更新的，依赖收集就是为派发更新做的准备，如果没有派发更新，依赖收集也就没了意义，所以下一小节我们就来了解一下<code>Vue</code>是怎么通过修改数据来触发页面的更新吧。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./main/chapter4/4-2.html" class="prev">
        4.2 依赖收集（上）
      </a></span> <span class="next"><a href="/./main/chapter4/4-4.html">
        4.4 派发更新
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.cb86b5c8.js" defer></script><script src="./assets/js/2.8a65079d.js" defer></script><script src="./assets/js/11.a8d301ee.js" defer></script>
  </body>
</html>
