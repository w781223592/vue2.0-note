(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{273:function(t,s){t.exports="data:image/png;base64,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"},317:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("  组件化是"),s("code",[t._v("vue.js")]),t._v("的一个核心思想。组件就是将一段样式和其对应的功能作为独立的整体去看待，无论这个整体放在哪里去使用，它都具有一样的功能和样式，从而实现复用，这种整体化的思想就是组件化。组件化设计就是为了增加复用性，灵活性，提高系统设计，从而提高开发效率。")]),t._v(" "),s("h1",{attrs:{id:"_3-1-创建组件vnode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-创建组件vnode"}},[t._v("#")]),t._v(" 3.1 创建组件vnode")]),t._v(" "),s("p",[t._v("组件这个名词对于我们使用过"),s("code",[t._v("vue")]),t._v("的人来说不会太陌生，写代码就好像盖房子一样，通过各个部件组成摩天大楼，接下来我们来分析"),s("code",[t._v("vue")]),t._v("中的组件化实现。\n在前面我们分析"),s("code",[t._v("_createElement")]),t._v("方法的时候有这样一段对"),s("code",[t._v("tag")]),t._v("类型的判断：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'string'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// direct component options / constructor")]),t._v("\n    vnode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("我们之前手写"),s("code",[t._v("render")]),t._v("函数的时候"),s("code",[t._v("tag")]),t._v("是一个字符串类似于"),s("code",[t._v("div")]),t._v("这种，所以我们之前只分析了"),s("code",[t._v("tag")]),t._v("类型是"),s("code",[t._v("string")]),t._v("时候的逻辑，其实"),s("code",[t._v("else")]),t._v("中是组件相关逻辑，前面已经分析过了"),s("code",[t._v("_createElement")]),t._v("方法最终就是返回"),s("code",[t._v("vnode")]),t._v("，很明显"),s("code",[t._v("else")]),t._v("中逻辑就是将组件转化成"),s("code",[t._v("vnode")]),t._v("的过程，它使"),s("code",[t._v("vnode")]),t._v("等于"),s("code",[t._v("createComponent()")]),t._v("方法返回结果。\t\n我们先来写这样一个例子：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./App.vue'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("h")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这个简单的"),s("code",[t._v("dome")]),t._v("就是渲染了"),s("code",[t._v("App")]),t._v("组件，我们在"),s("code",[t._v("initRender")]),t._v("文档中已经分析过"),s("code",[t._v("render")]),t._v("\n函数中h方法的调用其实就是"),s("code",[t._v("_createElement")]),t._v("方法调用，我们这里只传入一个App组件实例，也就是"),s("code",[t._v("_createElement")]),t._v("方法的第二个参数"),s("code",[t._v("tag")]),t._v("（第一个参数是"),s("code",[t._v("new Vue")]),t._v("实例，在"),s("code",[t._v("_createElement")]),t._v("定义时已经被绑定），所以这里的"),s("code",[t._v("tag")]),t._v("是一个"),s("code",[t._v("object")]),t._v("而不是"),s("code",[t._v("string")]),t._v("，\n所以执行的是"),s("code",[t._v("createComponent")]),t._v("逻辑\n下面来分析"),s("code",[t._v("createElement()")]),t._v("方法，该方法定义在"),s("code",[t._v("vdom/create-component")]),t._v("文件下。这个函数内容还是比较多的我们还是拆解开来分析，它最终的返回值必然是"),s("code",[t._v("vnode")]),t._v("了。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createComponent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Ctor")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Class"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Component"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Function "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Object "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("VNodeData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  context"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  children"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("Array"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("VNode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" VNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Array"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("VNode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseCtor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_base "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// init时候设置为Vue 在 global-api/index.js")]),t._v("\n")])])]),s("p",[t._v("我们先来看它的参数，第一个参数是"),s("code",[t._v("Ctor")]),t._v("，可以是一个组件"),s("code",[t._v("class")]),t._v("、函数、对象、空，这里传入的是"),s("code",[t._v("tag")]),t._v("，也就是"),s("code",[t._v("import App")]),t._v("生成的对象，如下所示：")]),t._v(" "),s("div",{staticClass:"center"},[s("img",{attrs:{src:a(273)}})]),t._v(" "),s("p",[t._v("第二个参数"),s("code",[t._v("data")]),t._v("是可选参数；第三个参数"),s("code",[t._v("context")]),t._v("也就是父级"),s("code",[t._v("vm")]),t._v("实例；第四个参数"),s("code",[t._v("children")]),t._v("也是可选，第五个参数"),s("code",[t._v("tag")]),t._v("也是可选，我们上面调用的时候传了"),s("code",[t._v("tag")]),t._v("、"),s("code",[t._v("data")]),t._v("、"),s("code",[t._v("context")]),t._v("、"),s("code",[t._v("children")]),t._v("四个参数。\n然后我们看函数执行逻辑，首先是判断如果"),s("code",[t._v("Ctor")]),t._v("未定义就直接"),s("code",[t._v("return")]),t._v("，如果有的话就执行下一步。定义"),s("code",[t._v("baseCtor")]),t._v("变量为"),s("code",[t._v("context.$options._base")]),t._v("，这个属性在"),s("code",[t._v("init")]),t._v("时候被赋值为"),s("code",[t._v("Vue")]),t._v("，其逻辑在"),s("code",[t._v("global-api/init")]),t._v("文件下"),s("code",[t._v("initGlobalAPI()")]),t._v("函数中")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Vue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_base "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Vue\n")])])]),s("p",[t._v("在初始化全局api的时候它被赋值为"),s("code",[t._v("Vue")]),t._v("，我们在开发过程中第一个操作总是去"),s("code",[t._v("new")]),t._v(" "),s("code",[t._v("Vue()")]),t._v("，这时候我们执行init时候我们有合并"),s("code",[t._v("options")]),t._v("操作，这就使得我们"),s("code",[t._v("Vue")]),t._v("上的"),s("code",[t._v("options")]),t._v("被合并到了"),s("code",[t._v("vm.$options")]),t._v("上，然后我们就能在这儿获取到"),s("code",[t._v("Vue")]),t._v("，\n所以我们这里"),s("code",[t._v("baseCtor")]),t._v("就是"),s("code",[t._v("Vue")]),t._v("，然后看接下来的逻辑：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// plain options object: turn it into a constructor")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" baseCtor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("extend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("根据注释解释它是将普通对象转化为一个构造器，如果"),s("code",[t._v("Ctor")]),t._v("是一个对象类型(包括数组)，就使"),s("code",[t._v("Ctor")]),t._v("等于"),s("code",[t._v("Vue.extend(Ctor)")]),t._v("，下面我们就来看一下"),s("code",[t._v("Vue")]),t._v("全局"),s("code",[t._v("api")]),t._v("中的"),s("code",[t._v("extend")]),t._v("方法。"),s("code",[t._v("extend")]),t._v("方法的定义在"),s("code",[t._v("global-api/extend.js")]),t._v("文件下，在"),s("code",[t._v("initExtend")]),t._v("时候为"),s("code",[t._v("Vue")]),t._v("扩展了"),s("code",[t._v("extend")]),t._v("方法，该方法如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  Vue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("extend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extendOptions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    extendOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" extendOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Super "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SuperId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cachedCtors "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" extendOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("extendOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cachedCtors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SuperId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cachedCtors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SuperId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" extendOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateComponentName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("extend")]),t._v("方法接收一个参数"),s("code",[t._v("extendOptions")]),t._v("，函数开始将空"),s("code",[t._v("extendOptions")]),t._v("赋值为"),s("code",[t._v("{}")]),t._v("，然后定义"),s("code",[t._v("Super")]),t._v("变量保存"),s("code",[t._v("Vue")]),t._v("，这里this就是指向"),s("code",[t._v("Vue")]),t._v("的，然后定义"),s("code",[t._v("SuperId")]),t._v("来保存"),s("code",[t._v("initExtend")]),t._v("方法开头定义的"),s("code",[t._v("Vue.cid = 0")]),t._v("，接着定义"),s("code",[t._v("cachedCtors")]),t._v("来做一个缓存优化，主要在"),s("code",[t._v("extendOptions")]),t._v("没有"),s("code",[t._v("_Ctor")]),t._v("属性时对其扩展一个"),s("code",[t._v("_Ctor")]),t._v("属性，若"),s("code",[t._v("_Ctor")]),t._v("已经存在就把它赋值给"),s("code",[t._v("cachedCtors")]),t._v("，缓存是在后面做的，我们一会就见到了。\n接着判断"),s("code",[t._v("cachedCtors")]),t._v("中已有"),s("code",[t._v("SuperId")]),t._v("对应的缓存就直接返回缓存好的构造器。下一步定义了"),s("code",[t._v("name")]),t._v("变量等于 "),s("code",[t._v("extendOptions.name")]),t._v("或者"),s("code",[t._v("Suer.options.name")]),t._v("，在非生产环境且"),s("code",[t._v("name")]),t._v("存在的情况下执行"),s("code",[t._v("validateComponentName(name)")]),t._v("，接下来我们看看这个方法做了什么，通常在非开发环境的逻辑都是做一些校验，抛出一些错误和警告方便我们开发者定位错误，相信这儿也不例外，"),s("code",[t._v("validateComponentName定义于intance/util/options.js")]),t._v("下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateComponentName")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("^[a-zA-Z][\\\\-\\\\.0-9_")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("unicodeRegExp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("source"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("]*$")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Invalid component name: \"'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\". Component names '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'should conform to valid custom element name in html5 specification.'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// isBuiltInTag()判断是否是Vue标签， config.isReservedTag()判断是否是平台保留标签（html标签）")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isBuiltInTag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isReservedTag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Do not use built-in or reserved HTML elements as component '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id: '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("validateComponentName")]),t._v("校验首先是对符合"),s("code",[t._v("html5")]),t._v("规范有效自定义名称的校验，如果不符合规范就报一个警告。然后判断"),s("code",[t._v("isBuiltInTag() || config.isReservedTag()")]),t._v("，"),s("code",[t._v("isReservedTag")]),t._v("是不是很眼熟，在之前"),s("code",[t._v("_createElement")]),t._v("方法中判断"),s("code",[t._v("tag")]),t._v("类型为"),s("code",[t._v("string")]),t._v("时候的逻辑中已经用过这个判断了，当时是用来校验在原生"),s("code",[t._v("html")]),t._v("标签使用"),s("code",[t._v(".native")]),t._v("事件修饰符的时候用到的，这个在"),s("code",[t._v("helper")]),t._v("文档中有收录到，再来看"),s("code",[t._v("isBuiltInTag")]),t._v("方法，它是判断是否是"),s("code",[t._v("Vue")]),t._v("保留标签的方法，同样的我们把它收录到"),s("code",[t._v("helper")]),t._v("文档中。如果我们一旦用了原生"),s("code",[t._v("html")]),t._v("标签作为组件"),s("code",[t._v("name")]),t._v("时候就会报出上面这条警告。\n接着回到我们"),s("code",[t._v("extend")]),t._v("方法中：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("Sub")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VueComponent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sub")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sub")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constructor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sub\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      extendOptions\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'super'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super\n")])])]),s("p",[t._v("定义了一个子构造函数"),s("code",[t._v("Sub")]),t._v("，参数一样是"),s("code",[t._v("options")]),t._v("，一样执行了"),s("code",[t._v("this._init()")]),t._v("方法，再往下看"),s("code",[t._v("Sub.prototype")]),t._v("被赋值为一个由继承自"),s("code",[t._v("Super.prototype")]),t._v("的对象，实际上就是给"),s("code",[t._v("Sub")]),t._v("原型上挂上和"),s("code",[t._v("Vue")]),t._v("原型一样方法或属性，让它有和"),s("code",[t._v("Vue")]),t._v("一样的能力，给"),s("code",[t._v("Sub.prototype.constructor")]),t._v("赋值为"),s("code",[t._v("Sub")]),t._v("，然后给"),s("code",[t._v("Sub")]),t._v("设置唯一标识"),s("code",[t._v("cid")]),t._v("，再给"),s("code",[t._v("Sub")]),t._v("赋值合并后的"),s("code",[t._v("options")]),t._v("，合并时调用"),s("code",[t._v("mergeOptions()")]),t._v("方法，该方法被多次调用，我们之后会专门分析它。然后设置"),s("code",[t._v("Sub")]),t._v("的"),s("code",[t._v("super")]),t._v("属性为"),s("code",[t._v("Super")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// For props and computed properties, we define the proxy getters on")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the Vue instances at extension time, on the extended prototype. This")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// avoids Object.defineProperty calls for each instance created.")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对于props和computed属性，我们在扩展时在扩展原型的Vue实例上定义代理\tgetter。这避免了Object.defineProperty为创建的每个实例调用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initComputed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("接着判断"),s("code",[t._v("Sub.options")]),t._v("方法上是否存在"),s("code",[t._v("props")]),t._v("和"),s("code",[t._v("computed")]),t._v("，如果存在就分别进行初始化。我们先看"),s("code",[t._v("initProps")]),t._v("方法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("Comp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" props "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Comp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("proxy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Comp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("_props")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("先获取到"),s("code",[t._v("props")]),t._v("对象，然通过"),s("code",[t._v("for ... in")]),t._v(" 遍历执行"),s("code",[t._v("proxy()")]),t._v("方法，"),s("code",[t._v("proxy")]),t._v("方法定义在"),s("code",[t._v("instance/state.js")]),t._v("文件下，其实我们之前分析"),s("code",[t._v("initState")]),t._v("时候已经分析过它，其作用就是通过"),s("code",[t._v("Object.defineProperty")]),t._v("做数据劫持，"),s("code",[t._v("proxy()")]),t._v("详解。然后是"),s("code",[t._v("initComputed")]),t._v("方法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initComputed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("Comp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" computed "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Comp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" computed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComputed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Comp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" computed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("换药不换汤，只是遍历执行的方法改为了"),s("code",[t._v("defineComputed()")]),t._v("，我们把这部分分析也写在"),s("RouterLink",{attrs:{to:"/appendix/initState.html"}},[t._v("initState文档")]),t._v("中，因为它也是在"),s("code",[t._v("state.js")]),t._v("文件下定义的。它传入了三个参数，第一个也就是"),s("code",[t._v("Sub")]),t._v("的原型对象，第二个是遍历到的"),s("code",[t._v("key")]),t._v("，第三个则是"),s("code",[t._v("key")]),t._v("对应的"),s("code",[t._v("value")]),t._v("值。最后同样是做了数据的劫持。\n所以组件初始化"),s("code",[t._v("props")]),t._v("和"),s("code",[t._v("computed")]),t._v("时机是在定义子类构造函数的时候，官方注释说是为了避免"),s("code",[t._v("Object.defineProperty")]),t._v("方法在每次实例化组件时候都被调用。")],1),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// allow further extension/mixin/plugin usage")]),t._v("\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extend "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extend\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mixin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mixin\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("use "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("use\n")])])]),s("p",[t._v("然后添"),s("code",[t._v("extend")]),t._v("、"),s("code",[t._v("mixin")]),t._v("、"),s("code",[t._v("use")]),t._v("属性，就是"),s("code",[t._v("Vue")]),t._v("有的东西它都要有。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create asset registers, so extended classes")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// can have their private assets too.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// enable recursive self-lookup 启用递归自查")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sub\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后添加"),s("code",[t._v("ASSET_TYPES")]),t._v("里面的属性，包括"),s("code",[t._v("component")]),t._v("、"),s("code",[t._v("directive")]),t._v("、"),s("code",[t._v("filter")]),t._v("属性，然后在"),s("code",[t._v("name")]),t._v("存在时候启用递归自查")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// keep a reference to the super options at extension time.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// later at instantiation we can check if Super's options have")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// been updated.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//扩展时保留super options的引用，稍后在实例化时，")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们可以检查Super的选项是否已更新。")]),t._v("\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extendOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" extendOptions\n    Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sealedOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("extend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Sub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// cache constructor")]),t._v("\n    cachedCtors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SuperId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sub\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Sub\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("最后缓存"),s("code",[t._v("Sub")]),t._v("，开头对"),s("code",[t._v("cachedCtor[SuperId]")]),t._v("的"),s("code",[t._v("if")]),t._v("判断就是判断之前有没有缓存过这个"),s("code",[t._v("Sub")]),t._v("，我们每次引入同一个组件时引入的是同一个对象，这意味着"),s("code",[t._v("extendOptions")]),t._v("是相同的，所以我们可以找到之前的"),s("code",[t._v("extendOptions._Ctor")]),t._v("，然后我们就可以取到上次缓存的构造器了。但是这样来看"),s("code",[t._v("SuperId")]),t._v("是不是就没有意义了呢？之前我们分析过了"),s("code",[t._v("Super")]),t._v("其实就是"),s("code",[t._v("Vue")]),t._v("，"),s("code",[t._v("Vue.cid")]),t._v("是等于"),s("code",[t._v("0")]),t._v("的，我们没有在任何地方去修改它的值。而取这个缓存我们也是在组件对象中取的，那这个"),s("code",[t._v("SuperId")]),t._v("的意义在哪呢？它标识的是父构造器，0就是Vue构造器标识，我们之前也给"),s("code",[t._v("Sub")]),t._v("赋值了"),s("code",[t._v("extend")]),t._v("方法，所以"),s("code",[t._v("Sub")]),t._v("是可以继续构造新的子类，我们构造的每一个"),s("code",[t._v("Sub")]),t._v("都有唯一的cid标识，如果调用"),s("code",[t._v("Sub.extend")]),t._v("时我们将获得新的子类，这时候"),s("code",[t._v("SuperId")]),t._v("就是"),s("code",[t._v("Sub")]),t._v("的"),s("code",[t._v("cid")]),t._v("了，所以"),s("code",[t._v("SuperId")]),t._v("标识的这个子类是由哪个父构造器创建的。然后再考虑个问题，既然这里"),s("code",[t._v("cachedCtor")]),t._v("被定义为一个对象，说明它不会只有一个缓存，那么什么时候它会有多个构造器缓存呢？那就是当一个组件通过不同的父构造器构建子类构造器时那它就会缓存多个"),s("code",[t._v("Ctor")]),t._v("了。我们分析这儿就可以，至于实际有没有这样的运用就只能实践出真知了。最后"),s("code",[t._v("extend")]),t._v(" 方法返回了"),s("code",[t._v("Sub")]),t._v("构造器。\n回到"),s("code",[t._v("createComponent")]),t._v("方法中，我们一句话来解释"),s("code",[t._v("extend")]),t._v("就是通过继承方式创建了一个子构造器，"),s("code",[t._v("Ctor")]),t._v("就是这个构造器。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if at this stage it's not a constructor or an async component factory,")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// reject.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Invalid Component definition: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果"),s("code",[t._v("Ctor")]),t._v("不是一个函数就报一个无效的组件定义警告。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// async component")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" asyncFactory\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    asyncFactory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor\n    Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveAsyncComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("asyncFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" baseCtor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return a placeholder node for async component, which is rendered")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// as a comment node but preserves all the raw information for the node.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the information will be used for async server-rendering and hydration.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAsyncPlaceholder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        asyncFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        tag\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这部分是对异步组件的处理，我们在后面小节中会专门分析异步组件。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("对data进行简单的处理")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// resolve constructor options in case global mixins are applied after")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// component constructor creation")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveConstructorOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("对"),s("code",[t._v("options")]),t._v("重新计算，因为可能被一些全局的"),s("code",[t._v("mixins")]),t._v("所影响，接下来我们来看看"),s("code",[t._v("resolveConstructorOptions")]),t._v("方法的定义：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveConstructorOptions")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Ctor")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Class"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Component"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" superOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveConstructorOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("super"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cachedSuperOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superOptions\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("superOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" cachedSuperOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// super option changed,")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// need to resolve new options.")]),t._v("\n      Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("superOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" superOptions\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// check if there are any late-modified/attached options (#4976)")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查是否有任何延迟修改/附加选项")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" modifiedOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveModifiedOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update base extend options")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("modifiedOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("extend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extendOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" modifiedOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("superOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extendOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" options\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("该方法定义在"),s("code",[t._v("instance/init.js")]),t._v("文件下（最开始"),s("code",[t._v("_init")]),t._v("时候我们已经调用过这个方法，但是我们前面没有分析，现在我们放到这里讲解），首先从"),s("code",[t._v("Ctor")]),t._v("上获取"),s("code",[t._v("options")]),t._v("，如果"),s("code",[t._v("Ctor.options")]),t._v("存在，则传入"),s("code",[t._v("Ctor.super")]),t._v("递归调用"),s("code",[t._v("resolveConstructorOptions")]),t._v("，并使用"),s("code",[t._v("superOptions")]),t._v("保存返回的"),s("code",[t._v("options")]),t._v("，直到该构造器是最顶级父构造器为止。然后定义"),s("code",[t._v("cachedSuperOptions")]),t._v("保存"),s("code",[t._v("Ctor.superOptions")]),t._v("，之前已经提到了过了"),s("code",[t._v("Ctor")]),t._v("这个属性就是保存了"),s("code",[t._v("Vue.extend")]),t._v("时候的父构造器的"),s("code",[t._v("options")]),t._v("，它的定义就是为了这儿检查它是否被改变。正常情况"),s("code",[t._v("superOptions")]),t._v("和"),s("code",[t._v("cachedSuperOptions")]),t._v("是相等，但是因为一些全局的混入可能导致"),s("code",[t._v("super")]),t._v("的"),s("code",[t._v("options")]),t._v("被改变了，所以接下来对这种情况做了处理，先将"),s("code",[t._v("Ctor")]),t._v("的"),s("code",[t._v("superOptions")]),t._v("属性同步修改为"),s("code",[t._v("superOptions")]),t._v("。\n然后定义变量"),s("code",[t._v("modifiedOptions")]),t._v("保存"),s("code",[t._v("resolveModifiedOptions(Ctor)")]),t._v("返回，所以我们接下来看看"),s("code",[t._v("resolveModifiedOptions")]),t._v("方法：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveModifiedOptions")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Ctor")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Class"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Component"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("Object "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" modified\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" latest "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sealed "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sealedOptions\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" latest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("latest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" sealed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("modified"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" modified "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      modified"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" latest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" modified\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("该方法定义在同文件下，首先定义"),s("code",[t._v("modified")]),t._v("来保存改变的内容，然后定义"),s("code",[t._v("latest为Ctor.options")]),t._v(",也就是自身的"),s("code",[t._v("options")]),t._v("，再定义了"),s("code",[t._v("sealed")]),t._v("为"),s("code",[t._v("Ctor.sealedOptions")]),t._v("，密封的"),s("code",[t._v("options")]),t._v("也就是调用"),s("code",[t._v("Vue.extend")]),t._v("时候保存的自身"),s("code",[t._v("options")]),t._v("，为了方便这儿自查所以密封起来。然后遍历当前"),s("code",[t._v("options")]),t._v("，对比前后是否有不同属性，将差异化属性还是由键值对方式保存到"),s("code",[t._v("modified")]),t._v("中，最后返回"),s("code",[t._v("modified")]),t._v("。\n接下来我们就回到"),s("code",[t._v("resolveConstructorOptions")]),t._v("函数中的"),s("code",[t._v("if(modifiedOptions)")]),t._v("判断了，执行"),s("code",[t._v("extend(Ctor.extendOptions, modifiedOptions)")]),t._v("方法将修改的属性同步到"),s("code",[t._v("Ctor.extendOptions")]),t._v("中，然后再次合并"),s("code",[t._v("options")]),t._v("并用"),s("code",[t._v("options")]),t._v("保存合并后的"),s("code",[t._v("options")]),t._v("并将其赋值给"),s("code",[t._v("Ctor.options")]),t._v("。然后"),s("code",[t._v("options.name")]),t._v("存在的话就让"),s("code",[t._v("options.components[options.name]")]),t._v("等于"),s("code",[t._v("Ctor")]),t._v("。最后返回options。\n我们回到"),s("code",[t._v("createComponent")]),t._v("方法中，它对"),s("code",[t._v("v-model")]),t._v("做了一些处理，之后分析双向绑定时候我们再来分析")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// transform component v-model data into props & events")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformModel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("提取"),s("code",[t._v("props")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// extract props 提取props")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" propsData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("extractPropsFromVNodeData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("函数组件")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// functional component")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("functional"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFunctionalComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" propsData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这些内容我们先略过，在之后的章节详细分析。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// extract listeners, since these needs to be treated as")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// child component listeners instead of DOM listeners")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 提取侦听器，因为它们需要被视为子组件侦听器而不是DOM侦听器")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" listeners "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("on\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// replace with listeners with .native modifier")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// so it gets processed during parent component patch.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换为带有“native”修饰符的侦听器，以便在父组件patch期间对其进行处理")]),t._v("\n  data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("on "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nativeOn\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abstract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// abstract components do not keep anything")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other than props & listeners & slot")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// work around flow")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" slot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slot\n    data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("slot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" slot\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("对插槽的一些处理。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// install component management hooks onto the placeholder node")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("installComponentHooks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这儿有个比较重要的逻辑"),s("code",[t._v("installComponentHooks")]),t._v("方法，注册一些组件钩子，接下来看看"),s("code",[t._v("installComponentHooks")]),t._v("方法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("installComponentHooks")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" VNodeData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hooks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" hooksToMerge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hooksToMerge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" existing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" toMerge "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" componentVNodeHooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("existing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" toMerge "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("existing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" existing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_merged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      hooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" existing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeHook")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("toMerge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" existing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" toMerge\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("首先从"),s("code",[t._v("data")]),t._v("中获取"),s("code",[t._v("hook")]),t._v("，如果没有就添加"),s("code",[t._v("hook")]),t._v("，然后遍历"),s("code",[t._v("hooksToMerge")]),t._v("，我们先来看看"),s("code",[t._v("hooksToMerge")]),t._v("是个什么")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hooksToMerge "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("componentVNodeHooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("可以看到"),s("code",[t._v("hooksToMerge")]),t._v("是"),s("code",[t._v("componentVNodeHooks")]),t._v("对象的"),s("code",[t._v("keys")]),t._v("集合，然后我们看看"),s("code",[t._v("componentVNodeHooks")]),t._v("对象的定义")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// inline hooks to be invoked on component VNodes during patch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" componentVNodeHooks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" VNodeWithData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hydrating")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("boolean "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepatch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("oldVnode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MountedComponentVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("vnode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MountedComponentVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("vnode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MountedComponentVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("vnode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MountedComponentVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("componentVNodeHooks")]),t._v("定义了一些"),s("code",[t._v("hook")]),t._v("钩子函数，具体功能我们之后会具体分析，我们先回到"),s("code",[t._v("installComponentHooks")]),t._v("函数中，定义"),s("code",[t._v("key = hooksToMerge[i]")]),t._v(",然后定义"),s("code",[t._v("existing")]),t._v("等于"),s("code",[t._v("hooks[key]")]),t._v("，也就是"),s("code",[t._v("data.hook[key]")]),t._v("钩子，定义"),s("code",[t._v("toMerge")]),t._v("为"),s("code",[t._v("componentVNodeHooks")]),t._v("中对应"),s("code",[t._v("key")]),t._v("的函数，如果"),s("code",[t._v("existing")]),t._v("不等于"),s("code",[t._v("toMerge且existing")]),t._v(".\n"),s("code",[t._v("_merged")]),t._v("不存在时进行合并，将"),s("code",[t._v("componentVNodeHooks")]),t._v("中的钩子合并到"),s("code",[t._v("data.hook")]),t._v("中，如果"),s("code",[t._v("existing")]),t._v("存在说明存在同名函数，就执行"),s("code",[t._v("mergeHook")]),t._v("方法，否则直接等于"),s("code",[t._v("toMerge")]),t._v("就好了。然后我们看看"),s("code",[t._v("mergeHook")]),t._v("方法做了什么")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeHook")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("f1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("f2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Function "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("merged")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// flow complains about extra args which is why we use any")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  merged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_merged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" merged\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("其实就是个简单的合并策略，就是返回一个闭包函数来依次执行传入的两个函数，同时设置"),s("code",[t._v("merged._merged")]),t._v("为"),s("code",[t._v("true")]),t._v("，说明这是个已经合并过了，上面判断"),s("code",[t._v("existing._merged")]),t._v("为"),s("code",[t._v("true")]),t._v("就不会重复合并了。\n所以"),s("code",[t._v("installComponentHooks")]),t._v("方法其实就在data上注册初始化预先定义好的"),s("code",[t._v("hook")]),t._v("钩子，如果"),s("code",[t._v("data")]),t._v("上已经有了"),s("code",[t._v("hook")]),t._v("还能做一些合并处理。\n继续回到"),s("code",[t._v("createComponent")]),t._v("函数中")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return a placeholder vnode")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" tag\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vnode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue-component-")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Ctor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" propsData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listeners"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    asyncFactory\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...WEEX平台逻辑")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" vnode\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("最后定义"),s("code",[t._v("name")]),t._v("为"),s("code",[t._v("Ctor.options.name")]),t._v("或"),s("code",[t._v("tag")]),t._v("，然后创建"),s("code",[t._v("vnode")]),t._v("，创建组件"),s("code",[t._v("vnode")]),t._v("时候和普通"),s("code",[t._v("vnode")]),t._v("有点不一样，"),s("code",[t._v("tag")]),t._v("参数会添加一些标识，第三四五参数都是"),s("code",[t._v("undefined")]),t._v("，这儿特别指出第三个参数"),s("code",[t._v("children")]),t._v("为"),s("code",[t._v("undefined")]),t._v(",这是不同于之前我们创建"),s("code",[t._v("vnode")]),t._v("的（一些空的"),s("code",[t._v("vnode")]),t._v("或者文本节点除外，这些"),s("code",[t._v("vnode")]),t._v("创建基本上没有什么参数），然后它有多传了第七参数"),s("code",[t._v("componentOptions")]),t._v("，虽然"),s("code",[t._v("children")]),t._v("参数为空，但是"),s("code",[t._v("componentOptions")]),t._v("中是含有"),s("code",[t._v("children")]),t._v("的。省略"),s("code",[t._v("weex")]),t._v("平台逻辑，最终返回"),s("code",[t._v("vnode")]),t._v("。\n返回"),s("code",[t._v("vnode")]),t._v("之后基本上就跟我们之前流程一致了，"),s("code",[t._v("vm._render")]),t._v("函数返回"),s("code",[t._v("vnode")]),t._v("作为"),s("code",[t._v("vm._update")]),t._v("方法的第一个参数，"),s("code",[t._v("vm._update")]),t._v("函数中调用"),s("code",[t._v("patch")]),t._v("方法，最终完成组件的渲染。下一小节我们就来分析组件的"),s("code",[t._v("patch")]),t._v("方法。")])])}),[],!1,null,null,null);s.default=e.exports}}]);